<html>
<head>
<title text="#000011">Страничная организация памяти</title>
</head>
<body>
<CENTER>

<H1>Страничная организация памяти</H1>
<FONT SIZE="3">
</CENTER>
<UL>
 <LI><a href="#Преобразование адресов страниц прямым отображением">Преобразование адресов страниц прямым отображением</a>
 <LI><a href="#Преобразование адресов страниц ассоциативным отображением">Преобразование адресов страниц ассоциативным отображением</a>  
 <LI><a href="#Преобразование адресов страниц комбинированным ассоциативно-прямым отображением">Преобразование адресов страниц комбинированным ассоциативно-прямым отображением </a>
 <LI><a href="#Коллективное использование программ и данных в системе со страничной организацией">Коллективное использование программ и данных в системе со страничной организацией</a>
</UL>
<HR SIZE="4">

	Памятуя о том, насколько сложно обращаться с блоками переменных размеров при 
мультипрограммировании переменными разделами, давайте начнем с рассмотрения поблочного
отображения при фиксированном размере блока, т.е. со страничной организацией памяти.В 
настоящем разделе мы будем рассматривать страничную организацию памяти.<br><br>
	Виртуальный адрес в страничной системе - это упорядоченная пара (p,d), где p - номер
страницы в виртуальной памяти, а d - смещение в рамках страницы p, где размещается адресуемый
элемент (рисунок 1.6).<br><br>
<center>
<IMG SRC="nat8_8.jpg" border=0 align=center  vspace=15> </A>

<p>
	Рисунок 1.6 Формат виртуального адреса в системе с чисто страничной организацией.
</center><p>
	Процесс может выполняться, если его текущая страница находится в первичной памяти.
Страницы переписываются из внешней памяти в первичную и размещаются в ней в блоках, называемых
страничными кадрами и имеющих точно такой же размер, как поступающие страницы. Страничные кадры
начинаются с адресов первичной памяти, кратных фиксированному размеру страницы (рисунок 1.7).
Поступающая страница может быть помещена в любой свободный страничный кадр.<A HREF="../literatura.html">[4]</a><br><br>
<center>
<IMG SRC="nat8_9.jpg" border=0 align=center  vspace=15> </A>

<p>
	Рисунок 1.7 Разделение реальной памяти на страничные кадры.
</center><p>

<p>
	Днамическое преобразование адресов в системе со страничной организацией осуществляется
следующим образом. выполняющийся процесс обращается по адресу виртуальной памяти v=(p,d).
Механизм отображения страниц, показанный на рисунке 1.8 ищет номер страницы p в таблице
отображения страниц и определяет, что эта страница находится в страничном кадре p'. Адрес
реальной памяти формируется затем путем конкатенации p' и d. 
<center>
<IMG SRC="nat8_10.jpg" border=0 align=center  vspace=15> </A>

<p>
	Рисунок 1.8 Соответствие междуадресами виртуальной и реальнойпамяти
в системе со страничной организацией.
</center><p>

<p>	
	Рассмотрим теперь этот процесс более подробно. В частности, поскольку обычно не все
страницы процесса находятся в первичной памяти одновременно, таблица отображения страниц должна
указывать, есть ли адресуемая страница в первичной памяти, и если есть, то где именно, а если
нет, то в каком месте внешней памяти ее можно найти. На рисунке 1.9 показана типичная строка
таблицы отображения страниц. Бит-признак присутствия страницы r устанавливается в 0, если данной
страницы в первичной памяти нет. Если страницы нет, то s - ее адрес во внешней памяти. Если
страница есть в первичной памяти, то p' - номер ее страничного кадра. Отметим. что p' - это не
действительный адрес первичной памяти. Адрес первичной памяти a, с которого начинается страничный 
кадр p' (если размер страницы равняется p), определяется произведением
<center>
<IMG SRC="nat8_11.jpg" border=0 align=center  vspace=15> </A>

<p>
	Рисунок 1.9 Строка таблицы страниц.
</center><p>

<center>
a=(p)(p')
</center>
(если страничные кадры имеют номера 0,1,2 и т.д.). <br><br>
	В целях экономии емкости первичной памяти в таблицу отображения страниц можно не
включать адреса страниц во внешней памяти.
<P> 
<H2><a name="Преобразование адресов страниц прямым отображением">Преобразование адресов страниц прямым отображением</a></H2>
<P>
  В этом и нескольких следующих разделах мы рассмотрим несколько способов преобразования адресов
страниц. Рассмотрим вначале прямое отображение, которое иллюстрирует рисунок 1_10.
<center>
<IMG SRC="nat8_12.jpg" border=0 align=center  vspace=15> </A>

<p>
	Рисунок 1.10 Преобразование адреса страницы путем прямого отображения.
</center><p>

	Выполняющийся процесс делает ссылку по виртуальному адресу v=(p,d). Прежде, чем процесс начнет выполняться, 
операционная система загружает адрес первичной памяти для таблицы отображения страниц в
регистр начального адреса этой табоицы. Этот базовый адрес b таблицы прибавляется к
номеру страницы p, образуя адрес первичной памяти b+p для строки страницы p в таблице.
В этой строке указано, чтовиртуальной странице p соответствует страничный кадр p'. Затем
к значению p'приформировывается (путем конкатенации) смещение d, так что образуется реальный адрес r.
<I><B>Такой подход называется способом прямого отображения потому, что таблица отображения страниц содержит
отдельную строку для каждой страницы виртуальной памяти данного процесса.</I></B> Если процесс
имеет в виртуальной памяти n страниц, то таблица при прямом отображении для этого процесса содержит
последовательные строки для страницы 0, страницы 1, страницы 2, ..., страницы n-1.
	Как преобразуемый виртуальный адрес, так и базовый адрес таблицы отображения страниц хранятся в
высокоскоростных регистрах управляющего процессора, так что операции с их участием можно выполнять
очень быстро внутри командного цикла. Однако таблица прямого отображения страниц, которая может быть 
довольно большой, обычно находится в первичнй памяти. Следовательно для обращения к этой таблице
требуется один полный циклвыборки из первичной памяти. Поскольку время выборки из первичной памяти 
составляет, как правило, наибольшую долю цикла выполнения команды и поскольку нам требуется еще
один цикл обращения к первичной памяти для выборки соответствующей строки таблицы, это означает, что
использование метода прямого отображения совершенно не приемлем, например некоторые системы с
успехом его реализуют,размещая целиком всю таблицу в сверхвысокоскоростной кэш-памяти<A HREF="../literatura.html">[4]</a>.
<p>
<H2><a name="Преобразование адресов страниц ассоциативным отображением">Преобразование адресов страниц ассоциативным отображением</h2></a>
<p>
	Один из методов ускорения динамического преобразовния адресов заключается в том, чтобы
всю аблицу преобразования страниц разместить в ассоциативной памяти, длительность цикла которой,
быть может, на порядок меньше, чем у первичной памяти. На рисунке 1.11 показано , каким образом осуществляется 
динамическое преобразование адресов с чисто ассоциативным отображением. Работающая программа 
обращается по виртуальному адресу v=(p,d). Все строки таблицы, хранящиеся в ассоциативной памяти, одновременно 
сравниваются с адресом страницы p. ассоциативная память выдает значение p' как адрес страничного кадра,
соответствующего странице p, и путем конкатенации p' с значением смещения d формируется реальный адрес r.
Отметим, что стрелки, подведенные на рисунке к ассоциативной памяти, фактически затрагивают каждый элемент
таблицы. Это означает, что каждый элемент ассоциативной памяти одновременно анализируется на совпадение
с адресом p. именно из-за этого ассоциативная память является столь дорогостоящей.
<center>
<IMG SRC="nat8_13.jpg" border=0 align=center  vspace=15> </A>

<p>
	Рисунок 1.11 Преобразование адреса страницы при чисто ассоциативном отображении.
</center><p>
<p>
	Здесь опять-такивозникает дилемма: чтобы концепцию виртуальной памяти можно было реализовать на 
практике, неодходимо обеспечить быстрое динамическое преодразование адресов. Однако применение кэш-памяти
для реализации чисто прямого отображения или ассоциативной памяти для реализации чисто ассоциативного отображения
обходится слишком дорого. Нам нужна некая компромиссная схема, которая обладала бы основными
преимущствами методов, предусматривающих использование кэш-памяти или ассоциативной памяти, но 
при этом обходилась бы гораздо дешевле. 
<p>
<h2><a name="Преобразование адресов страниц комбинированным ассоциативно-прямым отображением">Преобразование адресов страниц комбинированным ассоциативно-прямым отображением отображением</a></h2>
<p>
	До сих пор в наших рассуждениях мы ориентировались преимущественно на аппаратные средства компьютера,
необходимые для эффективной реализации виртуальной памяти. При этом мы рассматривали аппаратные средства скорее
логически. чем физически. Нас интересует не конкретное построение устройств, а их 
функционкальная организация и относительные скорости. Именно таким и должен, как правило,
видеть аппаратные средства разработчик операционных систем, особенно в тех случаях, когда констукции аппаратных 
средств находятся на этапе отработки и могут изменяться.
<p>
	В последнее время аппаратные средства вычислительной техники развивались 
гораздо более высокими темпами, чем прграммное обеспечение. Сейчас в своем развитии они достигли
такого уровня, что обычные программисты не хотят привязываться к конкретной технике,
поскольку ожидают, что весьма скоро появятся более совершеные технические средства. Однако разработчики о
перационных систем, как правило, практически не имеют выбора в этом смысле, поскольку им приходится 
создавать операционные системы с использованием существующей аппаратуры. При этом они должны также 
учитывать реальные возможности и экономические характеристики современной техники.
В настоящее время кэш-память и ассоциативная память стоят гораздо дешевле, чем первичная
память произвольного доступа. Это вынуждает нас идти на компромиссное решение при
реализации механизма отображения страниц.
<p>
	Этот механизм предусматривает использование ассоциативной памяти, способной хранить лишь 
небольшую часть полной таблицы отображения страниц для процесса(рисунок 1.12). В строках
этой таблицы отображаются только те страницы,к которым были последние ссылки,- это делается с 
учетом того эвристического соображения, что к странице, к которой осуществлялось обращение в
недалеком прошлом, будет, по всей вероятности, новое обращение в ближайшем будущем.
Современные системы, в которых используется частичная ассоциативная таблица страниц,
обеспечивают скоростные показатели, составляющие 90 и более процентов показателей ,
возможных при полной ассоциативной таблице. 
<center>
<IMG SRC="nat8_14.jpg" border=0 align=center  vspace=15> </A>

<p>
	Рисунок 1.12 Преобразование адреса страницы при комбинированнном ассоциативно-прямом отображении.
</center><p>

<p>
	Динамическое преобразование адресов в данном случае осуществляется следующим
образом. Работающая программа обращается по виртуальному адресу v=(p,d). Механизм 
преобразования адресов вначале пытается найти страницу p в частичной ассоциативной 
таблице. Если страница p оказывается здесь, то ассоциативная таблица выдает p' как номер
кадра, соответствующей виртуальной странице p, и значение p' сцеплятся со смещением d,
образуя реальный адрес r, соответствующий виртуальному адресу v=(p,d).
<p>
	Для того, чтобы обеспечить хорошие скоростные показатели, частичная ассоциативная 
таблица должна быть небольшой. И действительно, системы , в которых этот пожход реализуется
с использованием всего лишь восьми или шестнадцати регистров ассоциативной памяти,
зачастую достигают 90 или более процентов скорости, возмоной в случае полной ассоциативной,
таблицы, которая в современных системах может потребовать в 100 раз большего числа регистров.
Это происходит благодаря особому свойству выполняющихся процессов, которое назвается
<I><B>локальностью</I></B>; это явление мы рассмотрим в следующей главе.
<p>
	Использование комбинированного механизма преобразования с ассоциативно-прямым
отображением - это инженерное решение, которое базируется на экономических факторах,
свойстенных существующей аппаратуре.<A HREF="../literatura.html">[4]</a> 
<p>
<h2><a name="Коллективное использование программ и данных в системе со страничной организацией">Коллективное использование программ и данных в системе со страничной организацией</a></h2>
<p>
 	В мультипрограммных вычислительных системах, особенно в системах с разделением
времени, обычно бывает так, что многие пользователи выполняют одни и те же программы.
Если бы каждому пользователю предоставлялись индивидуальные копии этих программ, то 
значительная часть основной памяти затарачивалась бы понапрвсну. очевидное решение этой
проблемы - коллективно (совместно) использовать (разделять) те страницы, которые
можно разделять.
<p>
	Коллективное использование должно тщательно координироваться, чтобы предотвратить 
ситуацию, когда один процесс будет изменять данные, считываемые в это времы другим процессом.
В большинстве современных вычислительных систем. реализующих коллективное использование памяти,
программы обычно состоят из двух отдельных частей, области процедур и области данных. Неизменяемые 
процедуры называются чистыми, или реентерабельными процедурами. Изменяемые данные,
естественно, коллективно использовать нельзя; неизменяемые данные (например, постоянную табличную
информацию) - можно. Изменяемые процедуры коллективно использовать нельзя.
<p>
	Все эти рассуждения говорят о том, что каждую страницу памяти необходимо 
идентифицировать как либо используемую коллекти вно, либо нет. После того, как страницы
каждого процесса будут таким отбразом разделены на две категории, в системе с чисто
страничной организацией можно реализовать коллективное использование, как показано 
на рисунке 1.13. Указывая в строках таблицы страниц различных процессов один и тот же 
страничный кадр, можно обеспечить совместное использование этого кадра соответствующими
процессами. Коллективное использование информации уменьшает объем первичной памяти,
необходимой для эффективного выполнения группы процессов, и может обеспечить для данной 
системы возможность обслуживания большого числа пользователей.
<center>
<IMG SRC="nat8_15.jpg" border=0 align=center  vspace=15> </A>

<p>
	Рисунок 1.13 Коллективное использование программ и данных в чисто
страничной системе.
</center><p>
</html>