<html>
<head>
<title text="#000011">Странично-сегментная организация памяти</title>
</head>
<body>
<CENTER>

<H1>Странично-сегментная организация памяти</H1>
<FONT SIZE="3">
</CENTER>

<UL>
<LI><a href="#Динамическое преобразование адресов в системах со странично-сегментной организацией">Динамическое преобразование адресов в системах со странично-сегментной организацией</a>
<LI><a href="#Коллективное использование программ и данных в системе со странично-сегментной организацией">Коллективное использование программ и данных в системе со странично-сегментной организацией</a> 
</UL>
<HR SIZE="4">

	И сегментная, и страничная организации имеют важные достоинства как  способы
построения виртуальной памяти. Начиная с ситем середины 60-х годов, в частности
с информационно-вычислительной системы с разделением времени Multics и системы 
разделеения времени TSS корпорации IBM, во многих вычислительных машинах применяется
комбинированнная странично-сегментная организация памяти. Эти системы обладают достоинствами 
обоих способов реализации виртуальной памяти. Сегменты обычно содержат целое число страниц,
причем не обязательно, чтобывсе страницы сегмента находились в первичной памяти
одновременно, а смежные страницы виртуальной памяти не обязательно должны оказываться
смежными в реальной памяти. В системе со странично- сегментной организацией применяется
трехкомпонентная (трехмерная ) арресация, т.е. адрес виртуальной памяти v определяется как
упорядоченная тройка v=(s,p,d), где s - номер сегмента, p - номер страницы, а d -
смещение в рамках страницы, по которому находится нужный элемент (рисунок 1.19)
<center>
<p>
<IMG SRC="nat8_24.jpg">
<p>
Рисунок 1.19. Формат виртуального адреса в странично-сегментной системе.
</center>
<p>

<p>
<H2><a name="Динамическое преобразование адресов в системах со странично-сегментной организацией">Динамическое преобразование адресов в системах со странично-сегментной организацией</a></h2>
<p>
	 Рассмотрим теперь динамическое преобразование виртуальных адресов в реальные
в странично-сегментной системе с применением комбинированного ассоциативно-прямого
отображения, как показано на рисунке 1.20<A HREF="../literatura.html">[4]</a>.
<center>
<p>
<IMG SRC="nat8_25.jpg">
<p>
Рисунок 1.20. Преобразование виртуального адреса путем комбинированнного
ассоциативно-прямого отображения в странично-сегментной системе.
</center>
<p>
	Выполняющийся процесс делает ссылку по виртуальному адресу v=(s,p,d). Самые
последние по времени обращения страницы имеют соответствующие строки в ассоциативной
таблице. система производит ассоциативный поиск, пытаясь найти строку с параметрами
(s,p) в ассоциативной таблице. Если такая строка здесь обнаруживается, то страничного
кадра p', по которому эта страница размещается в первичной памяти, соединяется со смещением
d, образуя реальный адрес r, соответствующий виртуальному адресу v, - и на этом
прелбразование адреса завершается.
<p>
	В обычном случае большинство запросов на преобразование адресов удается удовлетворить
подобным ассоциативным поиском. Если же требуемого адреса в ассоциативной памяти нет,
то преобразование осуществляется способом полного прямого отображения. Это делается
следующим образом: базовый адрес b таблицы сегментов прибавляется к номеру сегмента s,
так что образуется адрес b+s строки для сегмента s в таблице сегментов по первичной памяти.
В этой строке указывается базовый адрес s' таблицы страниц для сегмента s. Номер страницы
p прибавляется к s', так что образуется адрес p+s' строки в таблице страниц для 
страницы p сегмента s. Эта таблица позволяет установить, что виртуальной странице p
соответствует номер кадра p'. Этот номер кадра соединяется со смещением d, так что
образуется реальный адрес r, соответствующий виртуальному адресу v=(s,p,d).
<p>
	Эта процедура преобразования адресов описана, конечно, в предположении, что
каждый необходимый элемент информации находится именно там, где ему положено быть.
Однако в процессе преобразования адресов существует много моментов, когда обстоятельства
могут складываться не столь благоприятно. Просмотр таблицы сегментов может показать, что
сегмента s  в первичной памяти нет; при этом возникает прерывание по отсутствию сегмента,
операционная система найдет нужный сегмент во внешней памяти, сформирует для него таблицу
страниц и загрузит соответствующую страницу в первичную память, быть может, вместо
некоторой существующей страницы этого или какого-либо другого процесса. Когда сегмент
находится в первичной памяти, обращение к таблице страниц может показать, что нужной 
страницы в первичной памяти все же нет. При этом произойдет прерывание по отсутствию
страницы, операционная система возьмет управление на себя, найдет данную страницу во
внешней памяти и загрузит ее в первичную память (быть может опять-таки с замещением
другой страницы). Как и при чисто сегментной системе, адрес виртуальной памяти может
выйти за рамки сегмента и произойдет прерывание по выходу за пределы сегмента. Или
контроль по битам-признакам защиты может выявить, что операция, выполнение которой
запрашивается по указанному адресу, не разрешена, вселедствие чего произойдет прерывание
по защите сегмента. Операционная система должна предусматривать обработку всех этих
ситуаций.
<p>
	Ассоциативная память (или аналогично высокоскоростная кэш-память) играет решающую
роль в обеспечении эффективной работы механизма динамического преобразования адресов. 
Если преобразование адресов производить спомощью чисто прямого отображения с ведением
в первичной памяти полного набора таблиц соответствия виртуальных и реальных адресов,
типичное обращение к виртуальной памяти потребовало бы цикла памяти для доступа к 
таблице сегментов, второго цикла памяти для доступа к таблице страниц и третьего для
доступа к нужному элементу в реальной памяти. Таким образом каждое обращение к адресуемому
элементу занимало бы три цикла памяти, т. е. реальное быстродействие вычислительной 
системы составило бы лишь приблизительно треть от номинального значения, а две трети
затрачивалось бы на преобразование адресов! Интересно, что при всего лишь восьми или
шестнадцати ассоциативных регистрах разработчики добиваются для многих систем показателей
быстродействия, составляющих 90 и более процентов полных скоростных возможностей их
управляющих (центральных) процессоров.
<p>
	Опишем структуру таблиц, необходимых для комбинированной странично-сегментной 
системы<A HREF="../literatura.html">[4]</a>. На самом верхнем уровне этой структуры находится таблица процессов, которая
содержит по строке для каждого процесса, известного системе. Строка таблицы процессов,
соответствующая конкретному процессу, указывает на таблицу сегментов этого процесса.
Каждая строка таблицы сегментов процесса указывает на таблицу страниц соответствующего
сегмента, а каждая строка таблицы страниц указывает либо на страничный кадр, в котором
размещается данная страница, либо на адрес внешней памяти, где можно найти эту страницу.
В системе с большим количеством процессов, сегментов и страниц вся эта табличная структура
может занимать значительную долю первичной памяти. Здесь следует учитывать,что преобразование
адресов производится во время выполнения быстрее, если все таблицы находятся в первичной
памяти. Здесь следует учитывать, что преобразование адресов производится во время выполнения
бысрее, если всетаблицы находятся в первичной памяти. Однако чем больше таблиц в памяти,
тем меньше количество процессов система в состоянии поддерживать в текущий период,
а это может приводить к снижению пропускной способности. Разработчики операционных
систем должны анализировать многие подобные взамозависимости и принимать тщательно
сбалансировнные компромисные решения - только в этом случае можно обеспечить и эффективную
загрузку системы и оперативное предоставление ее услуг пользователям.
<p>
<h2><a name="Коллективное использование программ и данных в системе со странично-сегментной организацией">Коллективное использование программ и данных в системе со странично-сегментной организацией</a></h2>
<p>
	В странично-сегментной системе преимущество, обеспечиваемые коллективным использованием
сегментов, становятся особенно заметными. Коллективное использование здесь реализуется
благодаря тому, что в таблицах сегментов для различных процессов содержатся строки, 
указывающие на одну и ту же таблицу страниц.
<p>
	Коллективное использование программ и данных в любой системе, будь то страничная,
сегментная или странично-сегментная, требует очень четкого управления со стороны 
операционной системы. Чтобы убедится в этом, можно рассмотреть случай, когда поступающая
страница должна была бы заменить  в первичной памяти страницу, коллективно используемую
многими прцессами.
</html>