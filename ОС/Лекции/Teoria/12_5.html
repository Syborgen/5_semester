<HTML>
<HEAD>
<TITLE>Диски</TITLE>
</HEAD>
<BODY>
  <b><font size="6"><center>Диски</center></font></b><br>
  <br>
  Рассмотрим теперь некоторые реальные устройства ввода-вывода. Мы начнем с дисков. 
  Затем мы также познакомимся с часами, клавиатурами и дисплеями.<br>
  <br>
  <br>
<a NAME="01"></a>
  <b><font size="4">Аппаратная часть дисков</font></b><br>
  <br>
  Существует множество типов дисков. К наиболее часто встречающимся относятся 
  магнитные диски (жесткие и гибкие). Их особенностью является одинаковая скорость 
  чтения и записи, что делает их идеальными в качестве дополнительной памяти (страничная 
  подкачка файлов, файловые системы и т. д.). Иногда, с целью создания высоконадежного 
  устройства хранения, используются наборы жестких магнитных дисков. Для распространения 
  программ, данных и фильмов используются различные виды оптических дисков (CD-ROM, 
  CD-R, CD-RW и DVD). В следующих разделах мы сначала познакомимся с аппаратной 
  частью, а затем с программным обеспечением для этих устройств.<br>
  <br>
  <br>
  <b>Магнитные диски</b><br>
  <br>
  Магнитные диски организованы в цилиндры, каждый из которых содержит столько 
  дорожек, сколько есть у устройства головок, установленных вертикально. Дорожки 
  делятся на секторы, их количество обычно варьируется от 8 до 32 у гибких дисков 
  и до нескольких сот у жестких дисков. Число головок варьируется от 1 до 16.<br>
<dd> У некоторых магнитных дисков мало электроники, они предоставляют на выходе 
  простой поток битов. На этих дисках контроллер выполняет совсем немного работы. 
  На других дисках, в частности на IDE-дисках (IDE, Integrated Drive Electronics 
  — встроенный интерфейс накопителей), само устройство содержит микроконтроллер, 
  выполняющий значительный объем работ, и позволяющий собственно контроллеру обращаться 
  к нему с набором команд высокого уровня.<br>
<dd> IDE-диски обладают одним свойством, обладающим важными последствиями для 
  драйверов: контроллер способен выполнять одновременно поиск дорожки на двух 
  и более дисках. Это свойство известно под названием перекрывающегося поиска. 
  В то время как контроллер и программное обеспечение ожидают окончания операции 
  поиска на одном устройстве, контроллер может инициировать поиск на другом устройстве. 
  Многие контроллеры жестких дисков также могут совмещать операцию чтения или 
  записи на одном диске с поиском на другом или даже нескольких дисках. Однако 
  контроллеры гибких дисков не могут одновременно читать и писать на двух дисководах. 
  (Чтение или запись требует от контроллера перемещения битов с максимальной скоростью, 
  на которую он рассчитан, поэтому операция чтения или записи использует большую 
  часть его вычислительных мощностей.) В случае жестких дисков с их встроенными 
  микроконтроллерами ситуация радикально меняется, поэтому несколько жестких дисков 
  могут одновременно работать в одной системе, по крайней мере переносить данные 
  между диском и буфером контроллера. Однако между контроллером и оперативной 
  памятью в каждый момент времени может происходить только одна операция по переносу 
  данных. Способность одновременного выполнения двух или более дисковых операций 
  может существенно снизить среднее время доступа.<br>
<dd> В табл. 5.3 сравниваются параметры стандартного средства оригинального компьютера 
  IBM PC с параметрами современного жесткого диска для демонстрации того, насколько 
  сильно изменились магнитные диски за последние два десятилетия. Интересно отметить, 
  что не все параметры улучшились в равной мере. Среднее время поиска дорожки 
  улучшилось в семь раз, скорость передачи данных увеличилась в 1300 раз, тогда 
  как емкость диска увеличилась в 50 000 раз. Это различие вызвано относительно 
  незначительными усовершенствованиями механической части по сравнению со значительно 
  большим прогрессом в области увеличения плотности записи.<br>
  <br>
  <center>
    <font face="Arial"><b>Таблица 5.3.</b> Параметры 360-Кбайтного НГМД в сравнении 
    с жестким<br>
    диском Western Digital WD 18300<br>
    </font> 
    <TABLE FRAME="BOX" RULES="ALL" BORDER="1" CELLSPACING="0" CELLPADDING="0" WIDTH="559" HEIGHT="271">
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="center" VALIGN="center" WIDTH="211" HEIGHT="36"> <b> Параметр</b> 
        </TD>
        <TD ALIGN="center" VALIGN="center" WIDTH="123" HEIGHT="36"> <b> НГМД IBM 
          360 Кбайт</b> </TD>
        <TD ALIGN="center" VALIGN="center" WIDTH="133" HEIGHT="36"> <b> Жесткий 
          диск WD 1 8300</b> </TD>
      </TR>
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="LEFT" VALIGN="TOP" WIDTH="211" HEIGHT="26"> Количество цилиндров 
        </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="123" HEIGHT="26"> 40 </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="133" HEIGHT="26"> 10601 </TD>
      </TR>
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="LEFT" VALIGN="TOP" WIDTH="211" HEIGHT="20"> Дорожек в цилиндре 
        </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="123" HEIGHT="20"> 2 </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="133" HEIGHT="20"> 12 </TD>
      </TR>
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="LEFT" VALIGN="TOP" WIDTH="211" HEIGHT="21"> Секторов на дорожке 
        </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="123" HEIGHT="21"> 9 </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="133" HEIGHT="21"> 281 (среднее) 
        </TD>
      </TR>
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="LEFT" VALIGN="TOP" WIDTH="211" HEIGHT="20"> Секторов на диске 
        </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="123" HEIGHT="20"> 720 </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="133" HEIGHT="20"> 35742000 </TD>
      </TR>
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="LEFT" VALIGN="TOP" WIDTH="211" HEIGHT="21"> Байтов в секторе 
        </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="123" HEIGHT="21"> 512 </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="133" HEIGHT="21"> 512 </TD>
      </TR>
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="LEFT" VALIGN="TOP" WIDTH="211" HEIGHT="21"> Емкость диска </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="123" HEIGHT="21"> 360 Кбайт </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="133" HEIGHT="21"> 18,3 Гбайт </TD>
      </TR>
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="LEFT" VALIGN="TOP" WIDTH="211" HEIGHT="21"> Время поиска (min) 
        </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="123" HEIGHT="21"> 6 мс </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="133" HEIGHT="21"> 0,8 мс </TD>
      </TR>
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="LEFT" VALIGN="TOP" WIDTH="211" HEIGHT="20"> Время поиска (среднее) 
        </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="123" HEIGHT="20"> 77 мс </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="133" HEIGHT="20"> 6,9 мс </TD>
      </TR>
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="LEFT" VALIGN="TOP" WIDTH="211" HEIGHT="21"> Период обращения 
        </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="123" HEIGHT="21"> 200 мс </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="133" HEIGHT="21"> 8,33 мс </TD>
      </TR>
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="LEFT" VALIGN="TOP" WIDTH="211" HEIGHT="21"> Время start/stop 
          двигателя </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="123" HEIGHT="21"> 250 мс </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="133" HEIGHT="21"> 20 с </TD>
      </TR>
      <TR ALIGN="LEFT" VALIGN="TOP"> 
        <TD ALIGN="LEFT" VALIGN="TOP" WIDTH="211" HEIGHT="22"> Время передачи 
          1 сектора </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="123" HEIGHT="22"> 22 мс </TD>
        <TD ALIGN="center" VALIGN="TOP" WIDTH="133" HEIGHT="22"> 17 мкс </TD>
      </TR>
    </TABLE>
  </center>
  <br>
<dd> Глядя на спецификации современных жестких дисков, следует помнить, что указанная 
  геометрия, используемая программным обеспечением драйвера, может отличаться 
  от физического формата. На старых дисках число секторов на дорожке было одинаково 
  на всех цилиндрах. Современные диски разделены на зоны с большим числом секторов 
  на внешних дорожках и меньшим на внутренних. На рис. 5.14, <i>а</i> изображен 
  крошечный диск с двумя зонами. На внешней зоне каждая дорожка состоит из 32 
  секторов, тогда как на внутренней зоне по 16 секторов на дорожке. Реальные диски, 
  как, например, WD 18300, часто имеют по 16 зон с числом секторов, увеличивающимся 
  примерно на 4 % в каждой следующей зоне при движении от центра диска к краю.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_12.jpg" alt="Физическая геометрия диска с двумя зонами (а); возможная виртуальная геометрия этого диска (б)"><br>
    <br>
    <b><font face="Arial">Рис. 5.14.</font></b><font face="Arial"> Физическая 
    геометрия диска с двумя зонами (а); возможная виртуальная<br>
    геометрия этого диска (б)<br>
    </font><br>
  </center>
<dd> Чтобы не усложнять жизнь операционной системы излишними подробностями, современные 
  жесткие диски скрывают истинную геометрию и предоставляют в качестве интерфейса 
  виртуальную геометрию с одинаковым числом секторов на всех цилиндрах. Встроенный 
  микроконтроллер диска преобразует обращение к виртуальным цилиндру, головке 
  и сектору в физические соответствующие параметры. Возможная виртуальная геометрия 
  диска, изображенного на рис. 5.14, а, показана на рис. 5.14, <i>б</i>. В обоих 
  случаях диск имеет 192 сектора.<br>
<dd> Для компьютеров с процессором Pentium максимальными значениями этих трех 
  параметров часто являются значения 65 535, 16 и 63, что вызвано необходимостью 
  обратной совместимости с ограничениями оригинальной машины IBM PC. На ней для 
  хранения этих значений использовались 16-, 4- и 6-разрядные двоичные поля, причем 
  номера цилиндров и секторов начинались с 1, а номера головок — с 0. При таких 
  параметрах и 512 байтах на сектор максимальный размер поддерживаемого диска 
  равен 31,5 Гбайт. Чтобы преодолеть это ограничение, многими дисками теперь поддерживается 
  режим <b>LBA</b> (Logical Block Addressing — логическая адресация блоков), при 
  котором секторы диска просто нумеруются последовательно начиная с 0, независимо 
  от геометрии диска.<br>
  <br>
  <br>
  <b>RAID</b><br>
  <br>
  Производительность центральных процессоров за последнее десятилетие увеличивалась 
  экспоненциально, удваиваясь примерно каждые 18 месяцев. С производительностью 
  дисков дело обстояло совсем не так. В 70-е годы среднее время поиска на дисках, 
  используемых в мини-компьютерах, составляло от 50 до 100 мс. Сегодня время поиска 
  немного ниже 10 мс. В большинстве отраслей промышленности (например, в автомобильной 
  или авиационной) увеличение производительности в 5 или 10 раз за два десятилетия 
  считалось бы феноменальным, но в компьютерной промышленности такой низкий рост 
  является препятствием. За эти годы разрыв между производительностью центрального 
  процессора и производительностью диска только еще более увеличился, причем весьма 
  существенно.<br>
<dd> Как мы видели, для увеличения производительности центрального процессора 
  все больше используются параллельные вычисления. На протяжении десятилетий идея 
  распараллелить операции ввода-вывода также приходила в головы многих людей. 
  В 1988 году в своей статье Паттерсон и его коллеги предложили шесть различных 
  способов организации дисков для улучшения производительности или надежности 
  дисковых операций, либо и того и другого [261]. Эти идеи были быстро приняты 
  промышленностью, в результате чего был разработан новый класс устройств ввода-вывода, 
  названный <b>RAID.</b> Паттерсон с соавторами определили RAID как Redundant 
  Array of Inexpensive Disks — массив недорогих дисков с избыточностью, но промышленники 
  переопределили букву I как &laquo;Independent&raquo; (независимые). Возможно, 
  это должно было им позволить продавать диски по высоким ценам. Поскольку в этой 
  пьесе также требовался кто-нибудь на роль злодея (как и в случае противостояния 
  RISC и CISC, также благодаря Паттерсону), &laquo;негодяя&raquo; назвали <b>SLED 
  </b> (Single Large Expensive Disk — одиночный большой и дорогой дисковый накопитель).<br>
<dd> Идея, лежащая в основе системы RAID, состоит в том, что на компьютер (обычно 
  большой сервер) устанавливается коробка, полная дисков. Вместо обычного дискового 
  контролера устанавливается специальный RAID-контроллер, а весь набор дисков 
  выглядит с точки зрения операционной системы как один большой (и дорогой) дисковый 
  накопитель, то есть SLED, но обладает более высокой производительностью и большей 
  надежностью. Поскольку SCSI-диски отличаются высокой производительностью, низкой 
  ценой и способны работать до 7 штук на одном контроллере (до 15 для так называемого 
  &laquo;широкого&raquo; SCSI), неудивительно, что большинство RAID-систем состоят 
  из RAID-контроллера SCSI и коробки SCSI-дисков. Операционная система воспринимает 
  их как один большой диск. Таким образом, для использования системы RAID не требуется 
  никаких изменений программного обеспечения, что является большим плюсом с точки 
  зрения системных администраторов.<br>
<dd> Еще одно свойство всех RAID-систем состоит в том, что данные распределяются 
  по дискам, а это позволяет распараллеливать операции. Паттерсоном и его коллегами 
  было предложено несколько различных схем использования системы RAID, получивших 
  известность как уровни от нулевого до пятого. Помимо них существует еще несколько 
  второстепенных уровней, которые мы не станем здесь обсуждать. Употребление термина 
  &laquo;уровень&raquo; не совсем правильно в этом случае, так как данные схемы 
  использования системы RAID не образуют иерархии. Есть просто шесть различных 
  вариантов организации совместной работы дисков.<br>
<dd> Система RAID уровня 0 проиллюстрирована на рис. 5.15, <i>а</i>. Она рассматривает 
  единый виртуальный диск, эмулируемый контроллером RAID, как разбитый на полосы, 
  состоящие из одинакового числа секторов (обычно по 64 Кбайт), пересекающие наборы 
  дисков так, что первый блок секторов записывается на первый диск, второй блок 
  — на второй диск и т. д. по кругу. На рис. 5.15, <i>а</i> показана система RAID 
  уровня 0 для четырех дисков. Подобный способ хранения данных на нескольких дисках 
  называется <b>чередующимся набором.</b> При этом, если программа издает запрос 
  чтения или записи целой полосы данных, RAID-контроллер разбивает этот запрос 
  на отдельные запросы по числу дисков и адресует каждый запрос отдельному диску. 
  Таким образом, все диски системы RAID работают параллельно, причем программное 
  обеспечение об этом может даже не догадываться. Восстановление вышедшего из 
  строя диска в этом случае будет значительно сложнее, чем в системе RAID <a href="../comment.html#06">уровня 
  4</a>.<br>
<dd> Система RAID уровня 0 лучше всего работает с большими запросами, что естественно, 
  так как при этом работа более равномерно распределяется между дисками. В результате 
  производительность такой системы оказывается достаточно высокой при довольно 
  простой реализации.<br>
<dd> Хуже всего система RAID уровня 0 работает с операционными системами, имеющими 
  привычку запрашивать данные по одному сектору. Запрос будет выполнен верно, 
  но параллельной загрузки дисков при этом не получится и, соответственно, не 
  будет и выигрыша в производительности. Еще один недостаток системы RAID уровня 
  0 заключается в том, что надежность такой системы потенциально ниже, чем у одного 
  диска (SLED). Так, если система RAID состоит из четырех дисков со средней наработкой 
  на отказ для каждого диска, равной 20 000 часов, то при совместном использовании 
  этих дисков примерно раз в 5000 часов один из дисков будет отказывать, что приведет 
  к отказу всей системы RAID. Причем в этом случае могут быть потеряны все данные. 
  Таким образом, получается, что SLED оказывается в четыре раза надежнее. Поскольку 
  в системе RAID уровня 0 избыточность не предусмотрена, она не считается настоящей 
  RAID-системой.<br>
<dd> Следующий вариант, RAID уровня 1, показанный на рис. 5.15, <i>б</i>, представляет 
  собой настоящую систему RAID. В ней дублируются все диски, в результате имеются 
  четыре основных и четыре резервных диска. Такая система RAID называется также 
  зеркальным набором. При записи каждая полоса записывается дважды. При чтении 
  может использоваться любая копия. Таким образом, по сравнению с системой RAID 
  уровня 0 скорость записи не увеличивается, а чтение может быть ускорено вдвое. 
  Отказоустойчивость такой системы очень хороша, так как все данные дублируются 
  полностью. Для восстановления системы при выходе из строя одного из дисков нужно 
  всего лишь заменить диск и скопировать на него данные с диска-копии. Недостатком 
  является снижение используемой общей емкости дисков вдвое.<br>
<dd> В отличие от уровней 0 и 1, работающих с полосами и секторами, система RAID 
  уровня 2 работает на уровне слов и даже байтов. Представьте разбиение каждого 
  байта единого виртуального диска на пару 4-битовых полубайтов, затем добавление 
  к каждому из них кода Хэмминга с образованием 7-битового слова, в котором биты 
  1, 2 и 4 являются битами четности. Затем представьте, что семь дисков на рис. 
  5.15, <i>в</i> синхронизированы по скорости вращения и позиции головок. В этом 
  случае будет возможно записать закодированное по Хэммингу 7-битовое слово на 
  семь дисков, по биту на диск.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_13.jpg" alt="Системы RAID уровней от 0 до 5. Резервные диски затенены"><br>
    <br>
    <b><font face="Arial">Рис. 5.15.</font></b><font face="Arial"> Системы RAID 
    уровней от 0 до 5. Резервные диски затенены</font><br>
  </center>
  <br>
<dd> Эта схема использовалась в компьютере СМ-2 фирмы Thinking Machines. Бралось 
  32-разрядное слово данных, к нему добавлялись 6 битов четности, чтобы образовать 
  38-разрядное слово Хэмминга, плюс дополнительный бит четности. Полученное 39-разрядное 
  слово записывалось на 39 дисков. Таким образом, скорость операций чтения и записи 
  увеличивалась в 32 раза. Потеря одного из устройств также не вызывала особых 
  проблем, поскольку это приводило к потере всего одного бита в 39-разрядном слове, 
  с чем код Хэмминга легко справлялся на лету.<br>
<dd> Недостаток этой схемы заключался в том, что для ее работы требовалась синхронизация 
  вращения всех дисков. Кроме того, такая схема имела смысл только при значительном 
  количестве дисков. Даже при 32 дисков с данными и 6 с битами четности накладные 
  расходы составляли 19 %. Кроме того, контроллер должен постоянно и с большой 
  скоростью считать контрольную сумму по Хэммингу.<br>
<dd> Система RAID уровня 3 представляет собой упрощенную версию системы RAID уровня 
  2. Одна показана на рис. 5.15, <i>г</i>. В этой схеме для каждого слова данных 
  считается один бит четности, записываемый на отдельный диск четности. Как и 
  в случае системы RAID уровня 2, все диски должны быть точно синхронизированы, 
  так как слово данных побитно пишется сразу на все диски.<br>
<dd> На первый взгляд может показаться, что одиночный бит четности дает только 
  возможность выявления ошибок, но не их исправления. Для случайных ошибок в произвольном 
  разряде это справедливо. Однако для случая выхода из строя диска одного бита 
  вполне достаточно для полного восстановления данных, так как позиция бита известна. 
  В случае выхода диска из строя контроллер просто считает, что все биты, содержащиеся 
  на нем, равны нулю, определяя их истинное значение по четности разрядов, считанных 
  с остальных дисков. Хотя оба уровня 2 и 3 системы RAID позволяют добиться очень 
  высоких скоростей передачи данных, число отдельных запросов ввода-вывода, которые 
  они могут обработать, не выше, чем у отдельного диска.<br>
<dd> Системы RAID уровней 4 и 5 снова работают с полосами (чередующимися наборами 
  данных), а не с отдельными словами с битами четности, поэтому не требуют синхронизации 
  дисков. Система RAID уровня 4 (рис. 5.15, <i>д</i>) аналогична уровню 0, но 
  с дополнительным диском четности, содержащим сумму по модулю два всех данных 
  с остальных дисков. Если любой из дисков выйдет из строя, потерянные байты могут 
  быть восстановлены при помощи той же операции сложения по модулю два.<br>
<dd> Такая организация надежно защищает от выхода диска из строя, но при небольших 
  изменениях информации, хранящейся на дисках, производительность не только не 
  увеличивается, а даже наоборот, снижается. Если изменяется всего один сектор, 
  то все равно необходимо прочитать данные со всех дисков, чтобы заново рассчитать 
  значения битов четности, которые нужно будет перезаписать. В качестве альтернативы 
  можно читать старые данные пользователя и старое значение избыточной информации 
  и пересчитывать новое значение по этим данным. Но и такой вариант все равно 
  требует дополнительных операций чтения перед операциями записи.<br>
<dd> В результате повышенной нагрузки на диск, содержащей избыточные данные, этот 
  диск может стать узким местом системы. Эта проблема решается в системе RAID 
  уровня 5, в которой биты четности равномерно распределены по всем дискам, как 
  показано на рис. 5.15, <i>е</i>. На первый взгляд может показаться, что восстановление 
  вышедшего из строя диска в этом случае будет значительно сложнее, чем в системе 
  RAID уровня 4. Однако на самом деле оно ничем не отличается от предыдущего случая. 
  В обоих случаях нужно всего лишь сложить все данные на оставшихся дисках по 
  модулю 2, что обусловливается природой этой арифметической операции, являющейся 
  обратной для самой себя.<br>
  <br>
  <br>
  <b>Компакт-диски</b><br>
  <br>
  В 70-е годы появились оптические диски (в противоположность магнитным). Их плотность 
  записи сразу значительно превзошла плотность записи магнитных дисков. Изначально 
  оптические диски были разработаны для записи телевизионных программ, но затем 
  для них были придуманы другие сферы применения, в том числе хранение компьютерных 
  данных. Благодаря их потенциально огромной емкости, оптические диски стали предметом 
  большого числа исследований и совершили невероятно быструю эволюцию.<br>
<dd> Оптические диски первого поколения были разработаны голландским электронно-промышленным 
  конгломератом Philips для хранения фильмов. Они были 30 см в диаметре и продавались 
  на рынке под названием LaserVision, но без особого коммерческого успеха, разве 
  что в Японии.<br>
<dd> В 1980 году фирма Philips совместно с Sony разработала компакт-диск (CD, 
  Compact Disc), который быстро вытеснил вращающиеся со скоростью 33 1/3 оборотов 
  в минуту виниловые пластинки (хотя до сих пор отдельные люди, называющие себя 
  &laquo;аудиофилами&raquo;, утверждают, что качество звука у винилов выше, чем 
  у лазерных компакт-дисков). Точные технические детали компакт-диска были опубликованы 
  в виде Международного стандарта IS 10149, называемого в народе Красной книгой 
  из-за цвета обложки. Международные стандарты издаются Международной организацией 
  по стандартизации ISO (International Organization for Standardization). Каждому 
  международному стандарту обычно соответствует какой-либо национальный стандарт, 
  как, например, ANSI (American National Standards Institute — Национальный институт 
  стандартизации США) или DIN (Deutsche Industrie Norm — промышленная норма Германии), 
  применяемые в Европе. Публикация спецификаций компакт-диска в качестве международного 
  стандарта обеспечивает совместную работу компакт-дисков и проигрывателей для 
  них, выпущенных производителями всего мира. Все компакт-диски должны иметь диаметр 
  120 мм и толщину 1,2 мм, с 15-мм отверстием в середине. Аудиокомпакт-диски стали 
  первым цифровым носителем, завоевавшим успех на массовом рынке. Предполагается, 
  что они будут сохраняться до 100 лет. Пожалуйста, проверьте в 2080 году, так 
  ли это.<br>
<dd> Для производства компакт-дисков используется мощный инфракрасный лазер, которым 
  прожигаются отверстия диаметром 0,8 мкм в металлическом покрытии стеклянного 
  диска-оригинала, называемого также мастер-диском. С мастер-диска снимается слепок 
  с выпуклостями на месте прожженных лазером отверстий. С помощью этого слепка 
  из поликарбонатной смолы печатаются компакт-диски с тем же рисунком выемок, 
  что и на стеклянном оригинале. Затем застывший поликарбонат покрывается очень 
  тонким слоем отражающего свет алюминия, поверх которого диск покрывается защитным 
  лаком, а на него затем наносится этикетка. Углубления в поликарбонате называют 
  питами (pit — впадина), а нетронутые лазером участки между питами называют &laquo;землей&raquo; 
  или &laquo;сушей&raquo; (land).<br>
<dd> При воспроизведении полупроводниковый лазер низкой мощности освещает питы 
  и участки между ними лучом с длиной волны 0,78 мкм, в то время как они прокручиваются 
  с постоянной линейной скоростью. Лазер освещает алюминиевое покрытие диска сквозь 
  прозрачный поликарбонатный диск толщиной в 1,2 мм. Питы выглядят с этой стороны 
  как выступы высотой в четверть длины волны луча лазера. В результате интерференции 
  свет, отраженный от питов, имеет меньшую яркость, чем отраженный от участков 
  между ними, что и регистрируется фотодетектором как последовательность нулей 
  и единиц. На самом деле для большей надежности за 1 считается переход пит/земля 
  или земля/пит, а отсутствие перехода означает 0.<br>
<dd> Последовательность питов и промежутков между ними записывается в виде единой 
  непрерывной спиральной дорожки, начинающейся недалеко от центра диска и заканчивающейся 
  у края диска. Максимальная ширина спирали может составлять 32 мм, а число оборотов 
  — 22 188 (около 600 на мм). Длина спирали, показанной на рис. 5.16, достигает 
  5,6 км в длину.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_14.jpg" alt="Структура записи компакт-диска или CD-ROM"><br>
    <br>
    <b><font face="Arial">Рис. 5.16.</font></b><font face="Arial"> Структура записи 
    компакт-диска или CD-ROM</font><br>
  </center>
  <br>
<dd> Чтобы музыка воспроизводилась с постоянной скоростью, поток питов и промежутков 
  между ними должен двигаться под лучом лазера с постоянной линейной скоростью 
  в 120 см/с. Соответственно, по мере продвижения считывающей головки от центра 
  диска к краю, угловая скорость вращения компакт-диска должна постоянно уменьшаться 
  от 530 об/мин до 200 об/мин. В этом принципиальное отличие оптических дисков 
  от магнитных, вращающихся с <a href="../comment.html#07">постоянной угловой скоростью</a>, 
  не зависящей от текущего положения головок. Кроме того, 530 об/мин — это существенно 
  меньше, чем 3600 об/мин или 7200 об/мин, типичная скорость вращения магнитных 
  дисков.<br>
<dd> В 1984 году фирмы Philips и Sony осознали потенциал использования компакт-дисков 
  для хранения компьютерных данных, поэтому они опубликовали <b>Желтую книгу,</b> 
  в которой определили точный стандарт того, что теперь называется <b>CD-ROM</b> 
  (Compact Disk Read Only Memory — компакт-дисковое постоянное запоминающее устройство). 
  Поскольку ранок аудиокомпакт-дисков к тому моменту был уже весьма широк, было 
  решено сделать CD-ROM точно того же размера, что и аудиокомпакт-диски, а также 
  механически и оптически совместимыми с ними. Помимо возможности проигрывать 
  музыку на устройствах чтения CD-ROM, это также давало возможность использовать 
  для производства CD-ROM те же технологические линии, на которых производились 
  аудиокомпакт-диски. В результате себестоимость производства одного CD-ROM оказалась 
  намного ниже одного доллара. Недостатком такого решения явилась необходимость 
  использования в устройствах чтения CD-ROM медленных двигателей, вращающихся 
  с переменной скоростью.<br>
<dd> В Желтой книге был определен формат компьютерных данных. Новый стандарт также 
  улучшал способность системы исправлять ошибки, что было очень важно, так как 
  если на слух почти не заметно искажение одного бита то тут то там, для хранения 
  компьютерной информации требуется значительно более высокая надежность. Основой 
  формата CD-ROM является кодирование одного байта 14-разрядным числом. Как уже 
  было сказано, 14 разрядов достаточно для кодирования одного байта (8 бит) кодом 
  Хэмминга с запасом в два бита. В действительности используется более мощная 
  система помехоустойчивого кодирования. При чтении преобразование 14-В-8 осуществляется 
  аппаратно при помощи таблицы.<br>
<dd> На более высоком уровне группа из 42 последовательных 14-разрядных символов 
  образуют 588-разрядный <b>кадр.</b> Каждый кадр содержит 192 бит данных (24 
  байт). Оставшиеся 396 бит используются для коррекции ошибок и управления. До 
  сих пор используемая схема одинакова для звуковых компакт-дисков и CD-ROM.<br>
<dd> Желтая книга добавляет к этому стандарту группирование 98 кадров в так называемый 
  <b>CD-ROM-сектор,</b> как показано на рис. 5.17. Каждый CD-ROM-сектор начинается 
  16-байтовым заголовком, первые 12 байт которого содержат 00FFFFFFFFFFFFFFFFFFFF00 
  (шестнадцатеричное), чтобы считывающее устройство могло распознать начало CD-ROM-сектора. 
  Следующие три байта содержат номер сектора, что необходимо, так как поиск данных 
  на единственной спирали диска значительно сложнее, чем на магнитном диске, состоящем 
  из концентрических дорожек. При поиске программное обеспечение устройства приблизительно 
  вычисляет, куда переместить головку, а после перемещения головки считывает первый 
  заголовок, проверяя, насколько точно удалось приблизиться к требуемым данным. 
  Последний байт заголовка содержит код режима.<br>
<dd> Желтой книгой определяется два режима. В режиме 1 используется формат, показанный 
  на рис. 5.17, с 16-байтовым заголовком, 2048 байт данных и 288-байтовым кодом 
  исправления ошибок ЕСС (Error Correction Code), для которого используется перемежающийся 
  код Рида—Соломона. В режиме 2 поле данных объединяется с полем ЕСС в 2336-байтное 
  поле данных. Этот режим может использоваться для тех приложений, которым не 
  требуется (или у них нет на это времени) коррекция ошибок, например аудио или 
  видео. Обратите внимание, что коррекция ошибок осуществляется на трех уровнях: 
  внутри символа, в кадре и в CD-ROM-секторе. Однобитовые ошибки исправляются 
  на нижнем уровне, короткие пакеты ошибок корректируются на уровне кадров, а 
  все остальные ловятся на уровне сектора. В результате 98 кадров по 588 бит (7203 
  байт) содержат всего лишь 2048 байт полезной нагрузки, что соответствует эффективности 
  около 28 %. Такую цену приходится платить за надежность хранения информации 
  на оптическом диске.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_15.jpg" alt="Логическое расположение данных на CD-ROM"> 
    <br>
    <br>
    <b><font face="Arial">Рис. 5.17.</font></b><font face="Arial"> Логическое 
    расположение данных на CD-ROM</font><br>
  </center>
  <br>
<dd> Односкоростные CD-ROM-приводы считывают данные со скоростью 75 секторов в 
  секунду, что соответствует скорости передачи данных 153 600 байт/с в режиме 
  1 и 175 200 байт/с в режиме 2. Двухскоростные приводы в два раза быстрее и т. 
  д. Таким образом, 40-скоростной CD-ROM-привод может поставлять данные со скоростью 
  до 40x153 600 байт/с (6000 Кбайт/с), при условии, что интерфейс устройства, 
  шина и операционная система могут обработать такой поток данных. На стандартном 
  аудиокомпакт-диске помещается до 74 мин музыки, что при использовании его для 
  хранения данных в режиме 1 дает емкость в 681 984 000 байт. Эта величина обычно 
  обозначается как 650 Мбайт, так как 1 Мбайт равен 2<sup>20</sup> байт (1 048 
  576 байт), а не 1 000 000 байт.<br>
<dd> Обратите внимание, что даже 32-скоростное устройство чтения CD-ROM (4 915 
  200 байт/с) не ровня магнитному диску SCSI-2 со скоростью в 10 Мбайт/с, несмотря 
  на то что во многих CD-ROM-приводах используется интерфейс SCSI (IDE CD-ROM-приводы 
  также существуют). Если задуматься о времени поиска для устройств чтения CD-ROM, 
  составляющем несколько сот миллисекунд, станет ясно, что по производительности 
  эти устройства находятся совсем не в той &laquo;весовой&raquo; категории, где 
  жесткие магнитные диски, несмотря на довольно внушительную емкость.<br>
<dd> В 1986 году фирма Philips снова нанесла удар, выпустив Зеленую книгу, добавив 
  к стандарту графику и возможность совмещения в одном секторе аудио, видео и 
  данных, что существенно для мультимедийных компакт-дисков.<br>
<dd> Наконец, следует рассмотреть файловую систему, используемую на CD-ROM. Чтобы 
  один и тот же CD-ROM можно было использовать на различных компьютерах, необходимо 
  добиться соглашения по вопросу файловых систем для CD-ROM. Для достижения этого 
  соглашения представители многих компьютерных компаний встретились на озере Тахо, 
  в Хай Сьеррас, на границе Калифорнии и Невады. По названию местности была названа 
  разработанная ими файловая система High Sierra. Позднее она была оформлена в 
  виде Международного стандарта IS 9660.<br>
<dd> Файловая система High Sierra состоит из трех уровней. На первом уровне файлы 
  имеют имена формата, схожего с MS-DOS — до 8 символов имя файла плюс до 3 символов 
  расширение. В имени файла могут использоваться только прописные символы, цифры 
  и символ подчеркивания. Глубина вложенности каталогов ограничена восемью. Имена 
  каталогов не могут содержать расширений. Все файлы уровня 1 должны быть непрерывными, 
  чего не сложно добиться на носителе, на который информация записывается всего 
  один раз. Таким образом, любой CD-ROM, соответствующий уровню 1 стандарта IS 
  9660, может быть прочитан в системе MS-DOS, на компьютере Apple, в системе UNIX, 
  то есть практически на любом компьютере. Производители CD-ROM считают это свойство 
  большим плюсом.<br>
<dd> Уровень 2 стандарта IS 9660 разрешает использовать имена файлов длиной до 
  32 символов, а уровень 3 позволяет использовать сегментированные файлы. Расширения 
  стандарта Rock Ridge (прихотливо названное в честь города в фильме Джина Уайлдера 
  <i>Blazing Saddles)</i> разрешают использовать очень длинные имена (для UNIX), 
  а также универсальные идентификаторы UID, глобальные идентификаторы GID и связывание 
  файлов. Однако CD-ROM, не удовлетворяющие уровню 1 стандарта IS 9660, могут 
  оказаться нечитаемыми на многих компьютерах.<br>
<dd> CD-ROM становятся все более популярными для распространения игр, фильмов, 
  энциклопедий, атласов, учебников и т. п. Большая часть коммерческого программного 
  обеспечения сегодня распространяется на CD-ROM. Благодаря сочетанию большой 
  емкости и низкой цены CD-ROM удачно подходят для самых разнообразных приложений.<br>
  <br>
  <br>
  <b>Компакт-диски с возможностью записи</b><br>
  <br>
  Сначала оборудование, необходимое для создания CD-ROM (или аудиокомпакт-диска), 
  было крайне дорогим. Но как это обычно бывает в компьютерной промышленности, 
  ничто не остается дорогим надолго. К середине 90-х годов устройства для записи 
  компакт-дисков размером не более проигрывателей компакт-дисков стали обычными 
  периферийными устройствами, продающимися в большинстве компьютерных магазинов. 
  Эти устройства по-прежнему отличались от магнитных дисков, так как позволяли 
  только один раз записывать данные, которые потом было нельзя стереть. Тем не 
  менее они быстро нашли свою нишу в качестве носителей для резервных копий больших 
  жестких дисков, а также позволили отдельным пользователям или небольшим компаниям 
  производить свои небольшие серии CD-ROM или создавать оригиналы-макеты для доставки 
  их на коммерческие фабрики по производству компакт-дисков. Эти носители известны 
  под названием CD-R (CD-Recordable — компакт-диски с возможностью записи).<br>
<dd> Физически компакт-диски с возможностью записи, так же как и обычные CD-ROM, 
  состоят из 120-мм поликарбонатных пластин, с той разницей, что на них нанесена 
  спиральная дорожка глубиной 0,6 мм для направления луча лазера при записи. Дорожка 
  выполнена в виде синусоиды с амплитудой в 0,3 мм и частотой 22,05 кГц (при одинарной 
  скорости вращения диска), что обеспечивает постоянную обратную связь, позволяющую 
  отслеживать и корректировать скорость вращения диска. CD-R выглядят как обычные 
  CD-ROM, отличаясь от них в основном этикеткой и цветом. С верхней стороны CD-R 
  золотые, в отличие от серебристых обычных компакт-дисков. Этот цвет вас не обманывает. 
  Это действительно тонкий слой золота, используемый для отражения луча лазера 
  вместо алюминия. В отличие от обычных серебристых компакт-дисков, на поверхности 
  которых пресс-формой нанесены углубления, на CD-R-дисках отличия в отражающей 
  способности питов и промежутков между ними должны имитироваться другим способом. 
  Это достигается при помощи добавления специального слоя красителя между поликарбонатом 
  и отражающей золотой поверхностью, как показано на рис. 5.18. Используются два 
  типа красителя: синевато-зеленый цианин и желтовато-оранжевый фталоцианин. Химики 
  могут спорить до хрипоты, доказывая преимущества одного красителя над другим. 
  Эти красители сходны с используемыми в фотографии, что объясняет, почему корпорации 
  Eastman Kodak и Fuji являются основными производителями чистых CD-R.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_16.jpg" alt="Поперечный разрез CD-R и лазера (не в масштабе)"><br>
    <br>
    <b><font face="Arial">Рис. 5.18.</font></b><font face="Arial"> Поперечный 
    разрез CD-R и лазера (не в масштабе). Серебристые CD-ROM<br>
    имеют сходную структуру с той разницей, что у них нет слоя красителя, а вместо<br>
    золотого покрытия — алюминиевое с углублениями<br>
    </font><br>
  </center>
<dd> В изначальном состоянии уровень красителя прозрачен и позволяет лучу лазера 
  проходить сквозь него и отражаться от золотого покрытия. Во время записи лазер 
  переводится в режим высокой мощности (8-16 мВт). Когда луч лазера попадает на 
  краситель, он нагревает его, разрушая химические связи. При этом образуется 
  темное пятно. При чтении лучом лазера с мощностью 0,5 мВт фотодетектор замечает 
  разницу между темными пятнами, прожженными лазером, и нетронутыми прозрачными 
  областями. Это различие интерпретируется так же, как и разница между выемками 
  и ровной поверхностью у обычных компакт-дисков, даже на обычных устройствах 
  чтения CD-ROM и проигрывателях аудиокомпакт-дисков.<br>
<dd> Ни одна новая разновидность компакт-дисков не может обойтись без книги соответствующего 
  цвета, поэтому в 1989 году была опубликована <b>Оранжевая книга,</b> посвященная 
  компакт-дискам с возможностью записи. Этот документ определяет формат CD-R, 
  а также новый формат, <b>CD-ROM XA</b>, позволяющий посек -торно дописывать 
  информацию на CD-R. Группа последовательных секторов, записываемых за один раз, 
  называется <b>CD-ROM-дорожкой.</b><br>
<dd> Одним из первых применений CD-R была система Kodak PhotoCD, в которой диск 
  использовался в качестве фотоальбома. Клиент приносил отснятую фотопленку и 
  свой старый PhotoCD в киоск фирмы Kodak и получал обратно тот же самый диск 
  с дописанными на него новыми фотографиями. Новый пакет фотографий, созданных 
  при сканировании негативов, записывается на PhotoCD в виде отдельной CD-ROM-дорожки. 
  Инкрементная запись требовалась, так как в момент появления первых CD-R на рынке 
  их цена была слишком высока, чтобы использовать в качестве одноразового носителя.<br>
<dd> Однако инкрементная запись создает новую проблему. До выхода в свет Оранжевой 
  книги у всех CD-ROM было единое оглавление тома <b>VTOC</b> (Volume Table of 
  Contents) в начале диска. При использовании инкрементной (многодорожеч-ной) 
  записи такая схема перестает работать. Решение, опубликованное в Оранжевой книге, 
  состоит в том, что для каждой CD-ROM-дорожки создается собственное оглавление 
  тома VTOC. В нем могут перечисляться некоторые или все файлы предыдущих дорожек. 
  Когда CD-R вставляется в дисковод, операционная система перебирает все CD-ROM-дорожки 
  в поисках самого последнего оглавления тома, соответствующего текущему состоянию 
  диска. Включением в новое оглавление тома не всех файлов из предыдущего оглавления 
  создается иллюзия удаления файлов с диска. Дорожки могут объединяться в <b>сеансы,</b> 
  образуя диски с <b>многосеансовой </b> записью. Стандартные проигрыватели компакт-дисков 
  не поддерживают многосеансовые компакт-диски, так как они рассчитаны на единственное 
  оглавление тома в начале диска.<br>
<dd> Каждая дорожка должна быть записана на диск за одну непрерывную (без остановок) 
  операцию. В результате жесткий диск, с которого производится запись, должен 
  быть достаточно быстрым, чтобы успевать предоставлять записываемые данные вовремя. 
  Если копируемые на диск файлы разбросаны по всему жесткому диску, время поиска 
  может оказаться слишком долгим, что приведет к опустошению буфера и &laquo;пересыханию&raquo; 
  потока данных, поступающих на CD-R. В результате вместо диска с записями вы 
  получите блестящую (но несколько дороговатую) подставку под стаканы для прохладительных 
  (или горячительных) напитков, которая также неплохо летает. Программное обеспечение 
  для устройств записи CD-R обычно предлагает собрать все записываемые файлы в 
  виде единого непрерывного образа CD-ROM, размером в 650 Мбайт, прежде чем прожигать 
  CD-R, но эта процедура удваивает общее время записи диска и требует 650 Мбайт 
  свободного места на жестком диске. К тому же даже такая мера не спасает от случайностей, 
  как, например, перегрев жесткого диска, в результате которого он вдруг начинает 
  выполнять операцию термальной калибровки.<br>
<dd> Компакт-диски с возможностью записи упрощают отдельным пользователям и компаниям 
  задачу перезаписи CD-ROM и аудиокомпакт-дисков, обычно нарушая авторские права 
  издателя оригинального диска. Для усложнения жизни пиратов были разработаны 
  различные схемы, в частности усложняющие чтение CD-ROM чем-либо, не являющимся 
  программным обеспечением издателя. Одна из таких схем заключается в указывании 
  фиктивной многогигабайтной длины файлов, что усложняет копирование файлов на 
  жесткий диск при помощи стандартных программных средств. Истинные длины файлов 
  упрятаны в программном обеспечении издателя или в неожиданном месте компакт-диска, 
  возможно, в зашифрованном виде. Другая схема заключается в использовании намеренно 
  неверной ЕСС-ин-формации в некоторых секторах в расчете на то, что программное 
  обеспечение, копирующее компакт-диск, &laquo;исправит&raquo; эти ошибки. Программное 
  обеспечение издателя само проверяет коды исправления ошибок, и если они верны, 
  то отказывается работать. Также возможно использование нестандартных промежутков 
  между дорожками и других физических &laquo;дефектов&raquo;.<br>
  <br>
  <br>
  <b>Многократно перезаписываемые компакт-диски</b><br>
  <br>
  Хотя люди привыкли пользоваться носителями, позволяющими однократную запись, 
  такими как бумага или фотопленка, спрос на CD-ROM с возможностью многократной 
  перезаписи оставался. Такая технология недавно появилась под названием <b>CD-RW</b> 
  (CD-ReWritable — многократно перезаписываемые компакт-диски). CD-RW по размерам 
  ничем не отличаются от обычных компакт-дисков, CD-ROM или CD-R. Однако вместо 
  цианина или фталоцианина в CD-RW в качестве записывающего слоя используется 
  сплав серебра, индия, сурьмы и теллура. У этого сплава два устойчивых состояния: 
  кристаллический и аморфный, с различной отражающей способностью.<br>
<dd> В устройствах записи CD-RW используются лазеры с тремя различными уровнями 
  мощности. При высокой мощности лазер расплавляет сплав, преобразуя его из кристаллического 
  состояния с высокой отражающей способностью в аморфное состояние с низкой отражающей 
  способностью, соответствующее питу. При средней мощности лазер плавит сплав, 
  превращая его в кристаллическое состояние, соответствующее промежуткам между 
  питами. При низкой мощности лазер считывает информацию с диска, не вызывая фазовых 
  переходов сплава.<br>
<dd> Причина, по которой CD-RW не вытеснили с рынка CD-R, заключается в их значительно 
  более высокой цене. Кроме того, для архивирования жестких дисков невозможность 
  случайно стереть CD-R является большим плюсом.<br>
  <br>
  <br>
  <b>DVD</b><br>
  <br>
  Базовый формат компакт-дисков (CD/CD-ROM) не менялся с 1980 года. Однако технология 
  с тех пор ушла вперед, в результате чего стало экономически возможным создание 
  оптических дисков большей емкости. Спрос на такие диски уже весьма велик и продолжает 
  возрастать. Голливуд хотел бы заменить видеоленты цифровыми дисками, поскольку 
  диски обеспечивают более высокое качество изображения, дешевле в производстве, 
  долговечнее, занимают меньше места на полках магазинов и не требуют перемотки. 
  Компании, занимающиеся производством электронных потребительских товаров, ищут 
  новый продукт, который бы вызвал очередной покупательский бум, а различные компьютерные 
  компании мечтают добавить к своему программному обеспечению черты мультимедиа.<br>
<dd> В результате объединения технологических усилий и интересов трех богатейших 
  и мощнейших отраслей промышленности и была создана система DVD. Сокращение DVD, 
  изначально расшифровывающееся как Digital Video Disk (цифровой видеодиск), теперь 
  официально обозначает Digital Versatile Disk (универсальный цифровой диск). 
  В DVD используется та же самая общая схема, что и для компакт-дисков, то есть 
  те же 120-мм поликарбонатные диски, изготавливаемые печатным способом, содержащие 
  углубления, освещаемые лазером и считываемые фотодетектором. Новым для DVD было:<br>
  <br>
<dd> 1. Вдвое меньший размер питов (0,4 мкм против 0,8 мкм для компакт-дисков).<br>
<dd> 2. Более тугая спираль (0,74 микрона между соседними дорожками, вместо 1,6 
  мкм для компакт-дисков).<br>
<dd> 3. Красный лазер (с длиной волны 0,65 мкм вместо 0,78 мкм для компакт-дисков).<br>
  <br>
<dd> Вместе эти усовершенствования позволили увеличить емкость в семь раз, то 
  есть с 650 Мбайт до 4,7 Гбайт. Односкоростное устройство чтения DVD считывает 
  данные со скоростью 1,4 Мбайт/с (против 150 Кбайт/с для компакт-дисков). К сожалению, 
  переход на красный лазер (вроде тех, что используются в супермаркетах) означает 
  необходимость установки второго лазера или сложной преобразовательной оптики 
  для возможности считывать на новом устройстве обычных компакт-дисков. Такую 
  возможность обеспечивают далеко не все устройства чтения DVD. Кроме того, чтение 
  CD-R и CD-RW на DVD-проигрывателе может также оказаться невозможным.<br>
<dd> Достаточно ли емкости 4,7 Гбайт? Возможно. При использовании алгоритма сжатия 
  MPEG-2 (Международный стандарт IS 13346) диск емкостью 4,7 Гбайт может вместить 
  до 133 мин полноэкранного динамичного видеоизображения высокого разрешения (720x480), 
  а также звуковую дорожку на восьми языках плюс субтитры еще на 32 языках. Около 
  92 % всех фильмов, сделанных в Голливуде, короче 133 мин. Тем не менее для некоторых 
  приложений, таких как мультимедиа, игры или энциклопедии, может понадобиться 
  носитель большего размера, кроме того, возможно, кому-нибудь захочется поместить 
  на диск более одного фильма. Поэтому были определены четыре следующих формата:<br>
  <br>
<dd> 1. Односторонний, одноуровневый (4,7 Гбайт).<br>
<dd> 2. Односторонний, двухуровневый (8,5 Гбайт).<br>
<dd> 3. Двусторонний, одноуровневый (9,4 Гбайт).<br>
<dd> 4. Двусторонний, двухуровневый (17 Гбайт).<br>
  <br>
<dd> Зачем так много форматов? Ответ: политика. Фирмы Philips и Sony хотели создать 
  односторонний, двухуровневый диск, но фирмам Toshiba и Time Warner был нужен 
  двусторонний, одноуровневый. Фирмы Philips и Sony полагали, что клиенты вряд 
  ли будут рады необходимости переворачивать диск, а компания Time Warner не верила, 
  что двусторонние диски будут работать. В результате было принято компромиссное 
  решение: принять стандарты для всех четырех возможных комбинаций, а рынок пусть 
  сам разберется, какой из этих стандартов выживет.<br>
<dd> Двухуровневая технология заключается в том, что у диска есть с краю отражающий 
  слой и полуотражающий слой посредине. Считываться будет тот уровень, на который 
  будет сфокусирован лазер. Для нижнего уровня требуются питы и промежутки большего 
  размера, чтобы надежность считывания не пострадала. В результате нижний уровень 
  оказался немного менее емким.<br>
<dd> Двусторонний диск представляет собой просто два обычных 0,6-мм диска, склеенных 
  спинками. Чтобы толщина всех типов дисков была одинаковой, односторонний диск 
  состоит из обычного диска толщиной 0,6 мм, приклеенного к пустому поликарбонатному 
  основанию. (Возможно, в будущем вместо пустышки будут приклеивать 133 мин рекламы, 
  в надежде, что покупатели из любопытства заглянут туда.) Структура двустороннего 
  двухуровневого диска показана на рис. 5.19.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_17.jpg" alt="Двусторонний двухуровневый DVD"><br>
    <br>
    <b><font face="Arial">Рис. 5.19.</font></b><font face="Arial"> Двусторонний 
    двухуровневый DVD</font><br>
  </center>
  <br>
<dd> Технология DVD была разработана консорциумом из 10 компаний-производителей 
  бытовой электроники, семь из которых были японскими, в тесном сотрудничестве 
  с голливудскими студиями (некоторыми из них владеют японские электронные компании, 
  входящие в консорциум). Представителей компьютерной и телекоммуникационной промышленностей 
  не пригласили на пикник, в результате чего акцент оказался смещен в сторону 
  использования DVD для размещения на них фильмов в основном в коммерческих целях. 
  Например, стандартные свойства DVD включают пропуск грязных сцен в режиме реального 
  времени (что позволяет родителям превратить порнофильм в детскую сказку), шестиканальный 
  звук и поддержку Pan-and-Scan. Последняя особенность позволяет DVD-проигрывателю 
  динамически решать, как обрезать левый и правый края фильма (с соотношением 
  сторон 3:2), чтобы кадр помещался на экран современного телевизора (с соотношением 
  сторон 4:3).<br>
<dd> Кроме того, представителям компьютерной промышленности, возможно, просто 
  не пришло бы в голову намеренно добиваться несовместимости дисков, предназначенных 
  для продажи на разных континентах. Эта &laquo;функция&raquo; была включена по 
  требованию Голливуда, поскольку все голливудские фильмы сначала демонстрируются 
  на широких экранах США, после чего их везут в Европу. К этому времени в США 
  на полках магазинов уже появляются видеоверсии этих фильмов. Замысел состоял 
  в том, чтобы гарантировать, что европейские видеомагазины не купят диски в США 
  слишком рано, тем самым снизив доходы европейских кинотеатров. Если бы Голливуд 
  занимался компьютерным бизнесом, у нас сейчас были бы 3,5-дюймовые дискеты в 
  США и 9-см диски в Европе.<br>
  <br>
  <br>
<a NAME="02"></a>
  <b><font size="4">Форматирование дисков</font></b><br>
  <br>
  Жесткий диск состоит из стопки сделанных из алюминия, стекла или других материалов 
  пластин диаметра 5,25 дюйма или 3,5 дюйма (или даже меньших для ноутбуков). 
  На каждую пластину нанесен тонкий магнитный слой оксида металла. После создания 
  на диске нет никакой информации.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_18.jpg" alt="Сектор диска"><br>
    <br>
    <b><font face="Arial">Рис. 5.20.</font></b><font face="Arial"> Сектор диска</font><br>
  </center>
  <br>
<dd> Заголовок начинается с определенной последовательности битов, обеспечивающей 
  распознавание начала сектора аппаратурой. Он также содержит номера цилиндра 
  и сектора и еще некоторую информацию. Размер порции данных определяется программой 
  низкоуровневого форматирования. В большинстве дисков используются 512-байтовые 
  секторы. Поле ЕСС (Error Correction Code — код корректировки ошибок, контрольная 
  сумма) содержит избыточную информацию, позволяющую обнаруживать (и даже, возможно, 
  исправлять) ошибки чтения. Размер и содержимое этого поля зависят от производителя 
  диска и его желания увеличить емкость диска за счет снижения надежности или 
  наоборот, а также способности контроллера поддерживать тот или иной алгоритм 
  подсчета контрольной суммы. Не является редкостью, например, 16-байтовое поле 
  ЕСС. Кроме того, все жесткие диски обладают некоторым количеством запасных секторов, 
  используемых для замены секторов с производственными дефектами.<br>
<dd> При низкоуровневом форматировании 0-й сектор располагается на каждой следующей 
  дорожке со сдвигом относительно предыдущей дорожки. Это смещение, называемое 
  перекосом цилиндров, служит увеличению производительности диска. Замысел состоит 
  в том, чтобы диск мог читать несколько дорожек за одну операцию без потери времени 
  на ожидание. Суть проблемы можно проиллюстрировать на рис. 5.14, <i>а.</i> Предположим, 
  необходимо прочитать 18 секторов, начиная с сектора О внутренней дорожки. Чтение 
  16 секторов (полной дорожки) занимает один оборот диска, но для перехода на 
  следующую дорожку требуется время. К тому моменту, когда считывающая головка 
  будет установлена на нужное место, 17-й сектор (сектор 0 следующей дорожки) 
  уже успеет провернуться под головкой, поэтому, чтобы его прочитать, придется 
  ждать целый оборот диска. Эта проблема решается при помощи разметки секторов 
  со смещением, как показано на рис. 5.21.<br>
<dd> Величина перекоса цилиндров зависит от геометрии диска. Например, для диска, 
  вращающегося со скоростью 10 000 об/мин, время одного оборота составляет 6 мс. 
  Если на дорожке содержится 300 секторов, сектор проходит под головкой каждые 
  20 мкс. За время перемещения головки на соседнюю дорожку, равное 800 мкс, под 
  головкой пройдут 40 секторов. Таким образом, перекос цилиндров должен составлять 
  40 секторов, а не три сектора, как показано на рис. 5.21. Следует также заметить, 
  что переключение с одной головки на другую тоже занимает время, поэтому перекос 
  головок присутствует, но он не так велик, как перекос цилиндров.<br>
<dd> В результате низкоуровневого форматирования емкость диска немного уменьшается 
  в связи с расходами на заголовки сектора, межсекторные промежутки и поля ЕСС, 
  а также резервные секторы. Часто полезный объем жесткого диска составляет около 
  80 % от общего объема. Резервные секторы не входят в емкость отформатированного 
  диска, поэтому у всех дисков одного типа при поставке абсолютно одинаковая емкость, 
  независимо от числа дефектных секторов на дисках. (Если число дефектных секторов 
  превышает количество запасных секторов, то такой диск не проходит контроль качества 
  и не поставляется.)<br>
<dd> Прежде чем диском можно будет пользоваться, каждой пластине нужно программно 
  придать низкоуровневый формат. Этот формат состоит из серий концентрических 
  дорожек, содержащих определенное число секторов, с короткими промежутками между 
  секторами. Формат сектора показан на рис. 5.20.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_19.jpg" alt="Иллюстрация перекоса цилиндров"><br>
    <br>
    <b><font face="Arial">Рис. 5.21.</font></b><font face="Arial"> Иллюстрация 
    перекоса цилиндров</font><br>
  </center>
  <br>
<dd> В вопросе емкости дисков существует определенная путаница, вызванная желанием 
  производителей создать впечатление, что их диск больше, чем на самом деле. Поэтому 
  иногда производителем может рекламироваться неформатированная емкость жесткого 
  диска вместо форматированной. Например, возьмем диск с неформатированной емкостью 
  20x10<sup>9</sup> байт. Он может быть продан за 20-гигабайтный диск. Однако 
  после форматирования для данных окажутся доступными только 2<sup>34</sup>=17,2х10<sup>9</sup> 
  байт. Операционная система обычно считает гигабайты как 2<sup>30</sup> байт, 
  а не 10<sup>9</sup> байт. В результате она сообщит, что емкость диска составляет 
  16,0 Гбайт, а не 17,2 Гбайт.<br>
<dd> Путаницы добавляют единицы измерения скорости передачи данных, где приставка 
  &laquo;гига&raquo; снова означает 10<sup>9</sup>, а не 2<sup>30</sup>. Степени 
  числа 2 используются для измерения объема памяти, дисков, размеров файлов, где 
  кило, мега, гига и тера означают 2<sup>10</sup>,2<sup>20</sup>,2<sup>30</sup> 
  и 2<sup>40</sup>. Еще запутаннее этот вопрос становится, когда скорость передачи 
  данных измеряют то в килобитах в секунду (1000 бит/с), то в килобайтах в секунду 
  (1024 байт/с).<br>
<dd> Форматирование также влияет на производительность диска. Если у диска, вращающегося 
  со скоростью 10 000 об/мин, на каждой дорожке по 300 секторов размером по 512 
  байт, то вся дорожка, то есть 153 600 байт, считывается за 6 мс, что составляет 
  скорость считывания данных 25 600 000 байт/с или 24,4 Мбайт/с. Быстрее считывать 
  данные невозможно, независимо от используемого интерфейса, даже если это SCSI 
  со скоростью передачи данных 80 Мбайт/с или 160 Мбайт/с.<br>
<dd> Чтение с такой скоростью в течение длительного периода времени требует большого 
  буфера в контроллере. Представьте контроллер с буфером размером в один сектор, 
  которому дана команда прочитать два сектора подряд. Прочитав первый сектор с 
  диска и проверив его контрольную сумму, контроллер должен передать данные в 
  оперативную память. Пока первый сектор передается в оперативную память, второй 
  сектор уже провернется под головкой, и контроллеру придется ждать почти полный 
  оборот диска.<br>
<dd> Эта проблема может быть решена, если при форматировании нумеровать секторы 
  не подряд. На рис. 5.22, <i>а</i> показана обычная нумерация секторов. На рис. 
  5.22, <i>б</i> мы видим <b>однократное чередование</b> секторов, предоставляющее 
  контроллеру возможность перевести дух и скопировать прочитанный сектор из буфера 
  в оперативную память. Это позволяет снизить скорость считывания всего в два 
  раза, а не, например, в 300 раз, если на одной дорожке помещается 300 секторов.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_20.jpg" alt="Без чередования (а); однократное чередование (б); двукратное чередование (в)"><br>
    <br>
    <b><font face="Arial">Рис. 5.22.</font></b><font face="Arial"> Без чередования 
    (<i>а</i>); однократное чередование (<i>б</i>);<br>
    двукратное чередование (<i>в</i>)</font><br>
  </center>
  <br>
<dd> Если процесс копирования очень медленный, может потребоваться <b>двукратное 
  чередование,</b> показанное на рис. 5.22, <i>в.</i> Если у контроллера буфер 
  только на один сектор, то не важно, выполняется ли копирование в оперативную 
  память контроллером, центральным процессором или микросхемой DMA. На это все 
  равно нужно время. Чтобы избежать необходимости в чередовании секторов, контроллер 
  должен иметь достаточно большой буфер, чтобы прочитать в него сразу целую дорожку. 
  У многих современных контроллеров такой буфер есть.<br>
<dd> После выполнения низкоуровневого форматирования диск разбивается на разделы. 
  Логически каждый раздел диска воспринимается операционной системой как отдельный 
  диск. На компьютерах с процессором Pentium и большинстве других компьютеров 
  в секторе 0 помещается <b>главная загрузочная запись,</b> содержащая часть загрузочной 
  программы и таблицу разделов. Таблица разделов содержит номера начальных секторов 
  и размеры каждого раздела. На Pentium-компьютерах в таблице разделов есть место 
  для четырех разделов. Если все они предназначены для системы Windows, они будут 
  называться устройствами С:, D:, Е: и F:. Если на трех из них размещается система 
  Windows, а на четвертом UNIX, тогда Windows будет называть свои разделы С:, 
  D: и Е: (четвертый раздел не будет виден системе Windows). Первое устройство 
  чтения компакт-дисков будет называться F:. Чтобы компьютер мог загружаться с 
  жесткого диска, один из разделов должен быть помечен как активный.<br>
<dd> Последним этапом подготовки диска к употреблению заключается в <b>высокоуровневом 
  форматировании</b> каждого раздела (по отдельности). Эта операция помещает в 
  раздел загрузочный блок, бит-карту или список свободных блоков устройства, корневой 
  каталог и пустую файловую систему. Кроме того, в таблицу разделов помещается 
  определенный код, указывающий, какая файловая система используется в данном 
  разделе, поскольку многие операционные системы традиционно поддерживают несколько 
  несовместимых файловых систем. Затем в одном из разделов может быть установлена 
  операционная система.<br>
<dd> При включении питания компьютера запускается базовая система ввода-вывода 
  BIOS, которая считывает главную загрузочную запись <i>с</i> диска и передает 
  в него управление. Загрузочная программа определяет, который из разделов диска 
  является активным. Из этого раздела считывается и запускается загрузочный сектор. 
  Загрузочный сектор содержит маленькую программу, которая находит в корневом 
  каталоге определенный файл (либо операционную систему, либо загрузчик больших 
  размеров). Этот файл загружается в память и запускается.<br>
  <br>
  <br>
<a NAME="03"></a>
  <b><font size="4">Алгоритмы планирования перемещения головок</font></b><br>
  <br>
  В этом разделе мы рассмотрим некоторые вопросы, касающиеся в основном дисковых 
  драйверов. Прежде всего определим, сколько времени занимает считывание или запись 
  одного блока диска. Необходимое для этого время определяется тремя факторами:<br>
  <br>
<dd> 1. Время поиска (время перемещения головки на нужный цилиндр).<br>
<dd> 2. Задержка вращения (время, требуемое для поворота нужного сектора под головку).<br>
<dd> 3. Время передачи данных.<br>
  <br>
<dd> Для большинства дисков первая составляющая (время поиска) существенно превосходит 
  остальные две, поэтому значительного увеличения производительности системы можно 
  добиться, снижая время поиска.<br>
<dd> Если драйвер диска принимает и выполняет запросы по одному в порядке получения, 
  то есть по принципу &laquo;первым пришел — первым обслужен&raquo; (FCFS, First 
  Come, First Served), тогда мало что можно сделать для оптимизации времени поиска. 
  Однако при сильной загрузке диска возможно применение другой стратегии. В этом 
  случае высока вероятность поступления новых запросов от других процессов во 
  время перемещения головки для обработки предыдущего запроса. Многие дисковые 
  драйверы содержат таблицу, индексированную по номерам цилиндров, в которой в 
  единый связный список собираются все поступившие и ждущие обработки обращения 
  к цилиндрам.<br>
<dd> С помощью подобной структуры данных можно создать более совершенный алгоритм 
  планирования, чем простое обслуживание в порядке поступления запросов. Рассмотрим, 
  например, диск с 40 цилиндрами. Поступает запрос на чтение блока с цилиндра 
  11. Во время перемещения головки на 11-й цилиндр поступают новые обращения к 
  цилиндрам 1, 36,16, 34, 9 и 12. Новые запросы помещаются в таблицу, состоящую 
  из отдельных списков для каждого цилиндра. Поступившие запросы помечены крестиками 
  на рис. 5.23.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_21.jpg" alt="Алгоритм планирования - ближайший цилиндр первым"><br>
    <br>
    <b><font face="Arial">Рис. 5.23.</font></b><font face="Arial"> Алгоритм планирования 
    &laquo;ближайший цилиндр первым&raquo;</font><br>
  </center>
  <br>
<dd> Выполнив первый запрос (обращение к цилиндру 11), драйвер диска должен выбрать 
  следующий запрос. Если обслуживать запросы в порядке поступления, то он должен 
  переместить головку на цилиндр 1, затем на цилиндр 36 и т. д. В результате выполнение 
  этого алгоритма потребует перемещения блока головок на 10, 35, 20, 18, 25 и 
  3 цилиндра, что в сумме составит 111 цилиндров.<br>
<dd> Время перемещения головки можно уменьшить, выбирая каждый раз ближайший цилиндр. 
  При той же серии запросов, показанной на рис. 5.23, последовательность их обработки 
  выглядит как ломаная кривая внизу рисунка. При такой последовательности выполнения 
  запросов потребуются перемещения блока головок на 1, 3, 7, 15, 33 и 2 цилиндра, 
  что в сумме составит 61 цилиндр. Применение данного алгоритма, называющегося 
  <b>SSF</b> (Shortest Seek First — &laquo;ближайший запрос первым&raquo;), снижает 
  суммарные перемещения головок почти вдвое.<br>
<dd> К сожалению, у данного алгоритма есть свои недостатки. Предположим, во время 
  обработки запросов, показанных на рис. 5.23, поступили новые запросы. Например, 
  после обработки обращения к цилиндру 16 поступает новый запрос к цилиндру 8. 
  Новый запрос будет иметь приоритет над обращением к цилиндру 1. Затем, если 
  поступит запрос к цилиндру 13, то головка опять будет перемещаться к цилиндру 
  13 для обработки нового запроса, а запрос к цилиндру 1 останется необработанным. 
  При сильной загрузке диска головка диска будет большую часть времени находиться 
  где-то в районе средних цилиндров, а запросам к крайним цилиндрам диска придется 
  ждать, пока нагрузка диска случайно не снизится и обращений к середине диска 
  не станет меньше. В результате качество обслуживания запросов к цилиндрам, сильно 
  удаленным от середины, может оказаться низким. То есть в конфликт вступают принцип 
  минимизации времени отклика и принцип справедливости.<br>
<dd> В высотных зданиях также приходится иметь дело с данной проблемой планирования 
  обслуживания запросов лифта. Вызовы лифта постоянно поступают с разных этажей. 
  Компьютер, управляющий лифтом, должен следить за последовательностью поступления 
  запросов и обслуживать их либо в порядке подачи заявок, либо обслуживая первым 
  ближайший запрос.<br>
<dd> Однако в большинстве лифтов применяются различные алгоритмы, пытающиеся примирить 
  конфликтующие цели эффективности и справедливости. Обычно лифт продолжает двигаться 
  в одном направлении до тех пор, пока на этом направлении более не остается запросов. 
  Затем лифт меняет направление движения. Этот алгоритм, называющийся элеваторным 
  алгоритмом, требует от программного обеспечения следить всего за одним битом, 
  хранящим информацию о текущем направлении движения, <i>ВВЕРХ</i> или <i>ВНИЗ.</i> 
  Выполнив очередной запрос, диск или лифт проверяет значение бита. Если в нем 
  содержится значение <i>ВВЕРХ,</i> кабина лифта или блок головок перемещается 
  вверх к следующему запросу. Если в этом направлении запросов больше нет, состояние 
  бита инвертируется.<br>
<dd> Рисунок 5.24 иллюстрирует работу элеваторного алгоритма с теми же семью запросами, 
  что были использованы в качестве примера на рис. 5.23. Предполагается, что изначально 
  бит направления движения указывал <i>ВВЕРХ.</i> При этом цилиндры обслуживаются 
  в порядке 12, 16, 34, 36, 9 и 1, что соответствует перемещению блока головок 
  на 1, 4, 18, 2, 27 и 8 цилиндров и в сумме составляет 60 цилиндров. В данном 
  случае элеваторный алгоритм оказался даже слегка лучше, чем алгоритм SSF, однако 
  на практике он обычно несколько хуже. Достоинство элеваторного алгоритма состоит 
  в том, что при любом заданном наборе запросов верхняя граница необходимых перемещений 
  блока головок для выполнения всех запросов фиксирована и ограничена двойным 
  числом цилиндров.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_22.jpg" alt="Элеваторный алгоритм планирования обращений к диску"><br>
    <br>
    <b><font face="Arial">Рис. 5.24.</font></b><font face="Arial"> Элеваторный 
    алгоритм планирования обращений к диску</font><br>
  </center>
  <br>
<dd> Незначительная модификация этого алгоритма с меньшим разбросом времени отклика 
  состоит в том, чтобы сканировать цилиндры всегда в одном направлении [328]. 
  После обслуживания обращения к цилиндру с самым высоким номером блок головок 
  перемещается к самому нижнему запрашиваемому цилиндру, после чего продолжает 
  движение вверх. Таким образом, самый нижний цилиндр как бы считается расположенным 
  выше самого верхнего.<br>
<dd> Некоторые контроллеры дисков предоставляют программному обеспечению способ 
  узнавать номер текущего сектора под головкой. Такие контроллеры позволяют использовать 
  дополнительный метод оптимизации. Если есть два или более запросов к одному 
  и тому же цилиндру, драйвер может выбрать из них тот, сектор которого пройдет 
  под головкой первым. Обратите внимание, что при наличии нескольких головок у 
  диска последовательные запросы могут обращаться к различным дорожкам на одном 
  цилиндре. Контроллер может практически мгновенно переключаться с головки на 
  головку, так как такое переключение не требует ни перемещения блока головок, 
  ни ожидания поворота диска.<br>
<dd> Если у диска время перемещения головок значительно ниже задержки, связанной 
  со скоростью вращения диска, тогда следует применять другую стратегию оптимизации. 
  Запросы, ожидающие обработки, должны сортироваться по номерам секторов, и как 
  только следующий сектор приблизится к головке, блок головок должен быстро переместиться 
  на нужную дорожку, чтобы считать или записать его.<br>
<dd> У современных жестких дисков производительность настолько сильно определяется 
  задержками перемещения головок и вращения диска, что читать по одному или по 
  два сектора крайне неэффективно. По этой причине многие современные контроллеры 
  дисков читают и сохраняют в кэше по нескольку секторов сразу, даже если запрашивается 
  всего один сектор. Обычно при этом считывается запрашиваемый сектор и все остальные 
  секторы этой дорожки, при условии, что для них достаточно места в кэше контроллера. 
  Например, у диска, описанного в табл. 5.3, размер кэша обычно составляет 2 Мбайт 
  или 4 Мбайт. Режим использования кэша динамически определяется контроллером. 
  В простейшем режиме кэш разделяется на две секции, одна для запросов чтения, 
  другая для запросов записи. Если последующий запрос на чтение сектора может 
  быть удовлетворен прямо из кэша контроллера, запрашиваемые данные могут быть 
  выданы немедленно.<br>
<dd> Следует отметить, что кэш контроллера диска абсолютно никак не связан с кэшем 
  операционной системы. Кэш контроллера обычно содержит блоки, на которые запрос 
  еще не поступал, но которые было удобно прочитать, так как они случайно оказались 
  под головкой при чтении других блоков. Напротив, любой кэш операционной системы 
  состоит из блоков, на чтение которых были явно направлены запросы и которые, 
  по мнению операционной системы, могут понадобиться снова в ближайшем будущем 
  (например, блок диска, содержащий каталог).<br>
<dd> При одновременном обслуживании контроллером нескольких устройств таблица 
  запросов, ждущих обработки, должна поддерживаться отдельно для каждого устройства. 
  Когда любое из устройств завершает выполнение текущего запроса, ему нужно дать 
  команду на перемещение блока головок на цилиндр для выполнения следующего запроса 
  (при условии, что контроллер позволяет работать в режиме перекрывающегося поиска). 
  По завершении текущей операции переноса данных может быть выполнена проверка 
  правильного позиционирования блоков головок всех устройств. Если хотя бы один 
  блок установлен, может быть начат следующий перенос данных. В противном случае 
  драйвер должен выдать новую команду поиска цилиндра устройству, только что завершившему 
  операцию переноса данных, после чего перейти в состояние ожидания прерывания 
  от диска, установившего блок головок на нужный цилиндр и готового к перемещению 
  данных.<br>
<dd> Важно понимать, что во всех вышеизложенных алгоритмах планирования работы 
  дисков молчаливо подразумевается, что физическая геометрия дисков совпадает 
  с виртуальной. В противном случае планирование обращений к диску не имеет никакого 
  смысла, так как операционная система не сможет определить, какой цилиндр расположен 
  ближе к цилиндру 39, 40-й или 200-й. С другой стороны, если контроллер диска 
  способен принимать несколько внешних запросов одновременно, он может выполнять 
  все планирование внутренне. В этом случае алгоритмы сохраняют силу, но выполняются 
  на боле низком уровне, в контроллере.<br>
  <br>
  <br>
<a NAME="04"></a>
  <b><font size="4">Обработка ошибок</font></b><br>
  <br>
  Производители дисков постоянно раздвигают технологические пределы, увеличивая 
  линейную плотность битов. Окружность средней дорожки на 5,25-дюймовом жестком 
  диске составляет около 300 мм. Если эта дорожка содержит 300 секторов по 512 
  байт, то, с учетом потерь на межсекторные промежутки, заголовки секторов и поля 
  ЕСС, линейная плотность записи может составлять около 5000 бит/мм. Такая высокая 
  плотность записи требует крайне высокой степени гладкости поверхности диска 
  и тонкости магнитного покрытия. К сожалению, создать диск с такими высокими 
  характеристиками без дефектов невозможно. К тому моменту, когда производственные 
  технологии совершенствуются настолько, что позволяют создавать диски с такой 
  плотностью без дефектов, проектировщики дисков увеличивают плотность записи 
  для увеличения емкости дисков. Таким образом, диски, по-видимому, всегда будут 
  содержать определенное количество дефектов.<br>
<dd> Производственные дефекты проявляются в виде дефектных секторов, то есть секторов, 
  которые не читаются правильно после записи. Если дефект сектора невелик, например 
  всего несколько бит, такой сектор можно использовать, позволив полю ЕСС исправлять 
  ошибки при каждом чтении сектора. При более серьезных дефектах ошибка уже не 
  может быть скорректирована.<br>
<dd> Дефектные блоки могут обрабатываться контроллером или операционной системой. 
  При первом подходе каждый диск проверяется на фабрике, а список дефектных секторов 
  записывается на диск. Вместо каждого дефектного блока используется запасной.<br>
<dd> Подобная замена может выполняться двумя способами. На рис. 5.25, <i>а</i> 
  показана дорожка диска из 30 блоков и 2 запасных. Сектор 7 поврежден. Контроллер 
  может пометить один из запасных секторов как сектор 7, как показано на рис. 
  5.25, <i>б.</i> Другой способ состоит в сдвиге всех секторов на один сектор 
  (рис. 5.25, <i>в).</i> В обоих случаях контроллер должен знать номера каждого 
  сектора. Он должен хранить эту информацию либо в своих внутренних таблицах (по 
  одной на дорожку), либо перезаписывая заголовки секторов. При перезаписи заголовков 
  метод на рис. 5.25, <i>в</i> требует большей работы (так как для этого нужно 
  перезаписать 23 заголовка), но в конечном итоге он дает лучшую производительность, 
  так как при этом вся дорожка все так же может быть прочитана за один оборот.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_23.jpg" alt="Дорожка диска с дефектным сектором (а); замена дефектного сектора запасным (б); сдвиг всех секторов (в)"><br>
    <br>
    <b><font face="Arial">Рис. 5.25.</font></b><font face="Arial"> Дорожка диска 
    с дефектным сектором (а); замена дефектного сектора<br>
    запасным (б); сдвиг всех секторов (в)<br>
    </font><br>
  </center>
<dd> Ошибки могут возникать при выполнении обычных операций после установки диска. 
  Первая линия обороны при получении ошибки, которую не может исправить ЕСС, состоит 
  в простом повторении попытки чтения. Некоторые ошибки чтения вызываются попаданием 
  пылинки на головку и исчезают при повторной попытке. Если контроллер замечает 
  повторяющиеся ошибки на определенном секторе, он может переключиться с него 
  на запасной сектор раньше, чем сектор с ошибками выйдет из строя окончательно. 
  При этом данные не будут потеряны, а операционная система и пользователь даже 
  не заметят наличия проблемы. Для этого обычно применяется метод, показанный 
  на рис. 5.25, <i>б,</i> так как остальные секторы этой дорожки могут уже содержать 
  данные. Использование метода, изображенного на рис. 5.25, <i>в,</i> потребует 
  перезаписи не только всех заголовков, но также и копирования всех данных.<br>
<dd> Как говорилось ранее, есть два основных подхода к исправлению ошибок: обработка 
  их контроллером или операционной системой. Если контроллер не может прозрачно 
  преобразовывать секторы, тогда этим должна программно заниматься операционная 
  система. Это означает, что сначала она должна получить список всех дефектных 
  секторов, либо прочитав этот список с диска, либо самостоятельно проверив весь 
  диск. Узнав, какие секторы являются дефектными, она может создать таблицы соответствий. 
  Если преобразованием занимается операционная система, она должна гарантировать, 
  что дефектные секторы не встречаются в файлах, а также в списке или битовом 
  массиве свободных секторов. Один из способов добиться этого состоит в создании 
  секретного файла, включающего в себя все дефектные секторы. Если этот файл не 
  является частью файловой системы, пользователи не смогут его случайно прочитать 
  или, что еще хуже, удалить.<br>
<dd> Однако есть еще одна проблема, связанная с созданием резервных копий диска. 
  Если архивация диска выполняется по файлам, то важно, чтобы программа архивации 
  не пыталась копировать файл дефектных блоков. Для этого операционная система 
  должна спрятать этот файл настолько хорошо, чтобы даже архивирующая программа 
  не смогла его найти. Если же диск архивируется посекторно, а не пофай-лово, 
  то будет трудно, если вообще возможно, избежать ошибок чтения во время архивации. 
  Единственная надежда на то, что архивирующей программе достанет здравого смысла 
  прекратить попытки чтения дефектного сектора после 10 попыток и перейти к чтению 
  следующего сектора.<br>
<dd> Дефектные секторы не являются единственным источником ошибок. Также возникают 
  ошибки поиска цилиндра, вызванные механическими проблемами блока головок. Контроллер 
  следит за положением блока головок. При установке головки на заданный цилиндр 
  он выдает серию импульсов двигателю блока головок, по одному импульсу на цилиндр. 
  Когда блок головок устанавливается в требуемое положение, контроллер считывает 
  истинное значение цилиндра из заголовка первого попавшегося сектора. Если блок 
  головок оказывается не на той дорожке, на которой нужно, возникает ошибка поиска.<br>
<dd> Большинство контроллеров жестких дисков автоматически исправляют ошибки поиска, 
  но большинство контроллеров гибких дисков (включая установленные на компьютерах 
  с процессором Pentium) просто выставляют бит ошибки и оставляют все остальное 
  драйверу. Драйвер обрабатывает ошибку, издавая команду <b>recalibrate</b>. При 
  этом блок головок отодвигается на самую внешнюю дорожку диска до упора. Это 
  положение принимается контроллером за нулевую дорожку, таким образом, контроллер 
  снова начинает понимать, где находится блок головок. Обычно это решает проблему. 
  Если же нет, то либо нужно сменить диск, либо починить дисковод.<br>
<dd> Как мы видели, контроллер в действительности представляет собой небольшой 
  специализированный компьютер, полный программного обеспечения, переменных, буферов 
  и, по всей видимости, ошибок. Иногда необычное стечение обстоятельств, например 
  приход прерывания с одного устройства, в то время как другое устройство выполняет 
  команду recalibrate, может разбудить спящую до тех пор ошибку, в результате 
  которой контроллер может войти в бесконечный цикл или забыть, что он делал. 
  Разработчики контроллеров обычно готовятся к худшему и предоставляют на всякий 
  случай специальный контакт на микросхеме, обращение к которому вызывает сброс 
  контроллера. Если никакие другие меры не помогают, драйвер может установить 
  этот бит, приводящий к подаче сигнала на такой контакт, и сбросить контроллер. 
  Если и это не помогает, то все, что драйверу остается сделать, — это вывести 
  сообщение и сдаться.<br>
<dd> При повторной калибровке дисковод издает скрипучий звук, но в остальном эта 
  процедура обычно не очень сильно беспокоит. Однако имеются ситуации, в которых 
  повторная калибровка представляет собой серьезную проблему: системы с ограничениями 
  реального времени. При воспроизведении видео с жесткого диска или при перезаписи 
  файлов с винчестера на CD-R крайне важно, чтобы биты поступали с жесткого диска 
  с постоянной скоростью. В этих случаях повторная калибровка может нарушить непрерывность 
  потока битов и поэтому является неприемлемой. Для подобных приложений существуют 
  специальные накопители, называющиеся <b>AV-дисками</b> (Audio Visual disks — 
  аудио видео диски), которые никогда не выполняют операцию повторной калибровки.<br>
  <br>
  <br>
<a NAME="05"></a>
  <b><font size="4">Стабильное запоминающее устройство</font></b><br>
  <br>
  Как мы видели, диски иногда ошибаются. Хорошие секторы могут внезапно стать 
  дефектными. Целый диск внезапно может выйти из строя. Чередующиеся наборы данных 
  RAID могут защитить от выхода из строя нескольких секторов или целого диска. 
  Однако они не могут защитить от сбоев во время записи, при которых записываются 
  неверные данные или, что еще хуже, данные записываются не туда, куда надо, уничтожая 
  другие важные данные.<br>
<dd> Для некоторых данных крайне важно, чтобы данные никогда не были потеряны 
  или испорчены, даже по причине ошибок диска или центрального процессора. В идеале 
  диск должен просто всегда работать без ошибок. К сожалению, это недостижимо. 
  Однако можно создать дисковую подсистему, обладающую следующими свойствами: 
  получив команду записи, такое устройство либо корректно записывает данные, либо 
  не делает ничего, не изменяя хранящиеся на нем данные. Подобная система называется 
  <b>стабильным запоминающим устройством</b> и реализуется программно [195]. Ниже 
  будет описана разновидность оригинальной идеи.<br>
<dd> Прежде чем создать алгоритм, важно иметь ясную модель всех возможных ошибок. 
  Модель предполагает, что при записи блока (одного или нескольких секторов) эта 
  операция записи либо корректна, либо некорректна, и эта ошибка может быть обнаружена 
  с помощью последующего чтения и изучения полей ЕСС. Гарантированное обнаружение 
  ошибки невозможно в принципе, так как 512-байтовый сектор, способный хранить 
  2<sup>4096</sup> различных комбинаций данных, защищается 16-байтовым полем ЕСС, 
  способным принимать всего <a href="../comment.html#08">2<sup>128</sup> значений</a>, 
  из которых допустимыми являются далеко не все. Таким образом, существуют миллиарды 
  миллиардов комбинаций (из которых всего одна верная), соответствующих одному 
  и тому же значению поля ЕСС. Вероятность случайного совпадения значения 16-байтового 
  поля ЕСС составляет около 2<sup>-128</sup>, то есть настолько мало, что мы можем 
  называть это число нулем, хотя в действительности это не так.<br>
<dd> В модели также учитывается, что правильно записанный сектор может внезапно 
  стать дефектным и перестать читаться. Однако предполагается, что такие события 
  происходят столь редко, что вероятность выхода из строя одинаковых секторов 
  на основном и резервном дисках за небольшой интервал времени (например, один 
  день) можно смело считать равной нулю.<br>
<dd> Модель также допускает выход из строя центрального процессора. В этом случае 
  он просто останавливается. Любая операция записи, совершающаяся в этот момент, 
  также останавливается, это приводит к неверным данным в одном секторе и неверному 
  значению поля ЕСС, что может быть обнаружено позднее. При всех вышеперечисленных 
  условиях возможно создать 100-процентно надежное стабильное запоминающее устройство, 
  то есть либо записывающее данные корректно, либо оставляющее все хранящиеся 
  данные так, как есть. Конечно, такое устройство не может противостоять землетрясениям 
  или защитить данные от падения компьютера со стометровой высоты.<br>
<dd> Стабильное запоминающее устройство использует пару идентичных дисков, в которых 
  соответствующие блоки работают совместно, образуя блоки, защищенные от ошибок. 
  При отсутствии ошибок соответствующие блоки на обоих дисках идентичны. Для получения 
  одинакового результата может быть прочитан любой из дисков. Для достижения этой 
  цели определены три следующие операции.<br>
<dd> 1. <b>Стабильная операция записи</b>. Стабильная операция записи выглядит 
  следующим образом. Сначала на диск 1 записывается блок данных, который затем 
  считывается для проверки корректности выполнения этой операции. Если обнаруживается 
  ошибка, операции записи и чтения повторяются в цикле до тех пор, пока при чтении 
  блока не будет ошибки или пока этот цикл не будет выполнен определенное число 
  раз. Если после выполнения заданного числа циклов операций записи и чтения успешного 
  результата добиться не удается, блок диска помечается как дефектный и вместо 
  него используется резервный блок. После этого вся процедура повторяется до тех 
  пор, пока блок не будет записан, независимо от того, сколько резервных блоков 
  придется задействовать. Когда наконец удается записать блок на диск 1 с использованием 
  той же процедуры, записывается и проверяется соответствующий ему блок диска 
  2. Если повезет и центральный процессор не выйдет из строя до завершения всей 
  операции, блок будет корректно записан и проверен на обоих дисках.<br>
<dd> <b>2.</b> <b>Стабильная операция чтения. </b> При этой операции сначала считывается 
  блок с диска 1. Если проверка значения поля ЕСС не дает верного результата, 
  считывание блока и проверка контрольной суммы повторяются в цикле определенное 
  число раз. Если все попытки чтения оказываются неуспешными, соответствующий 
  блок читается с диска 2. Поскольку операция стабильной записи создает две проверенные 
  копии блока, а также предполагается, что вероятность внезапного выхода из строя 
  сразу двух соответствующих блоков за короткий интервал времени пренебрежимо 
  мала, операция стабильного чтения всегда завершается успешно.<br>
<dd> <b>3.</b> <b>Восстановление от сбоев. </b> После сбоя программа восстановления 
  сканирует оба диска и сравнивает соответствующие блоки. Если оба блока успешно 
  читаются и совпадают, то никаких действий не выполняется. Если у одного из блоков 
  при чтении обнаруживается ошибка контрольной суммы (ЕСС), то на место дефектного 
  блока записывается правильный блок. Если оба блока читаются без ошибки, но не 
  совпадают, тогда блок с диска 1 пишется поверх блока на диске 2.<br>
<dd> При отсутствии сбоев центрального процессора эта схема всегда работает, так 
  как при операции стабильной записи блок всегда записывается дважды, а также 
  предполагается, что сразу два соответствующих блока никогда не выходят из строя 
  одновременно. Как может повлиять сбой центрального процессора на операцию стабильной 
  записи? Результат зависит от того момента, когда произойдет сбой. Возможны пять 
  вариантов, показанные на рис. 5.26.<br>
  <br>
  <center>
    <img src="12/Tanenbaum_5_24.jpg" alt="Анализ влияния сбоя процессора на стабильность записи"><br>
    <br>
    <b><font face="Arial">Рис. 5.26.</font></b><font face="Arial"> Анализ влияния 
    сбоя процессора на стабильность записи</font><br>
  </center>
  <br>
<dd> На рис. 5.26, <i>а</i> сбой центрального процессора происходит прежде, чем 
  записывается какая-либо копия блока. При восстановлении ничего не меняется и 
  сохраняется старое значение, что является допустимым.<br>
<dd> На рис. 5.26, <i>б</i> сбой центрального процессора происходит во время записи 
  блока на диск <i>1,</i> в результате чего разрушается содержимое этого блока. 
  Программа восстановления обнаруживает эту ошибку и восстанавливает блок на диске 
  <i>1</i> с диска 2. Таким образом, результат сбоя устраняется и восстанавливается 
  старое значение.<br>
<dd> На рис. 5.26, <i>в</i> сбой центрального процессора происходит после записи 
  на диск <i>1,</i> но до записи на диск <i>2. </i> Программа восстановления копирует 
  блок с диска <i>1</i> на диск <i>2.</i> Операция записи считается успешной.<br>
<dd> Ситуация на рис. 5.26, <i>г</i> похожа на ситуацию на рис. 5.26, <i>б.</i> 
  При восстановлении дефектный блок заменяется правильным блоком. Окончательным 
  значением обоих блоков будет новое значение.<br>
<dd> Наконец, на рис. 5.26, <i>д,</i> как и в ситуации на рис. 5.26, <i>а,</i> 
  программа восстановления видит, что оба блока успешно читаются и совпадают. 
  Поэтому тут также ничего не изменяется.<br>
<dd> К данной схеме применимы различные методы оптимизации и усовершенствования. 
  Прежде всего, сравнение всех блоков, конечно, выполнимо, но все же занимает 
  слишком много времени. Значительно ускорить этот процесс можно, записывая номера 
  записываемых блоков перед операцией стабильной записи. В результате после сбой 
  нужно будет проверить состояние только этих блоков. Это может быть реализовано 
  несколькими различными способами. На некоторых компьютерах имеется небольшое 
  количество энергонезависимого ОЗУ, представляющего собой специальную CMOS-память 
  (Complementary Metal-Oxide Semiconductor — комплементарный металло-оксидный 
  полупроводник), питающуюся от отдельной литиевой батареи. Такие батареи служат 
  помногу лет, возможно, даже в течение всей жизни компьютера. В отличие от оперативной 
  памяти, содержимое которой теряется после сбоя, содержимое энергонезависимого 
  ОЗУ сохраняется. В энергонезависимом ОЗУ обычно хранится время и дата (изменяющиеся 
  специальной микросхемой). В результате в компьютерах часы идут даже тогда, когда 
  питание компьютера выключено.<br>
<dd> Предположим, что несколько байтов энергонезависимого ОЗУ свободны и доступны 
  операционной системе. Операция стабильной записи может поместить в него номер 
  блока, который будет записываться. После успешного завершения операции стабильной 
  записи на место номера блока в энергонезависимое ОЗУ записывается число, не 
  соответствующее никакому номеру блока, например -1. Таким образом, после сбоя 
  программа восстановления может проверить состояние энергонезависимого ОЗУ, чтобы 
  определить, не находилась ли во время сбоя операция стабильной записи в процессе 
  выполнения, и если да, то какой блок записывался. После этого остается проверить 
  всего два блока на правильность и совпадение.<br>
<dd> Если энергонезависимое ОЗУ недоступно, его можно имитировать следующим образом. 
  В начале выполнения операции стабильной записи в некий фиксированный блок диска 
  <i>1</i> записывается номер записываемого блока. Затем этот блок считывается 
  для проверки. Когда этот блок успешно записан, записывается и проверяется также 
  соответствующий блок диска <i>2.</i> Опять же в случае сбоя при записи номера 
  блока всегда можно определить, находилась ли в момент сбоя операция стабильной 
  записи в состоянии выполнения. Конечно, такой метод имитирования энергонезависимого 
  ОЗУ требует дополнительного выполнения восьми дисковых операций при стабильной 
  записи каждого блока, поэтому пользоваться таким методом нужно лишь в крайнем 
  случае.<br>
<dd> Следует обратить внимание еще на один момент. Мы предположили, что два соответствующих 
  блока на разных дисках не смогут стать дефектными за один день. Если же пройдет 
  много дней, то такое вполне может произойти. Поэтому раз в сутки должно выполняться 
  полное сканирование обоих дисков с исправлением всех ошибок. Таким образом, 
  например, каждое утро оба диска будут гарантированно идентичными. Тогда если 
  даже оба блока пары выйдут из строя, но с интервалом в несколько дней, все ошибки 
  будут исправлены корректно.<br>
</BODY>
</HTML>
