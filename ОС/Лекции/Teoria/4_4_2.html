<html>
</style>
<body lang=RU >
<h1 align="center">Файлы и файловая система</h1> 

<p>Файлы в UNIX играют ключевую роль, что не всегда справедливо для
других операционных систем. Трудно отрицать значение файлов для поль&shy;зователей,
поскольку все их данные хранятся в виде файлов. Однако по&shy;мимо этого, файлы в UNIX определяют
привилегии пользователей, по&shy;скольку права пользователя в большинстве случаев
контролируются с по&shy;мощью прав доступа к файлам. Файлы обеспечивают доступ к
периферий&shy;ным устройствам компьютера, включая диски, накопители на магнитной
ленте, CD-ROM, принтеры, терминалы, сетевые адаптеры и даже память. Для приложений UNIX доступ к дисковому
файлу &quot;неотличим&quot; от доступа, скажем, к принтеру. Наконец, все
программы, которые выполняются в&nbsp;
системе, включая прикладные задачи пользователей, системные процессы и
даже ядро UNIX, являются исполняемыми файлами.</p> 

<p>Как и во многих современных операционных системах, в UNIX файлы организованы в
виде древовидной структуры (дерева), называемой <i>файловой системой </i>(file system).&nbsp; Каждый файл имеет имя, определяющее его ' расположение
в дереве файловой системы. Корнем этого дерева является <i>корневой каталог </i>(root directory), имеющий имя
&quot;/&quot;. Имена всех остальных файлов содержат <i>путь — </i>список
каталогов (ветвей), которые необходимо пройти, чтобы достичь файла. В UNIX все доступное
пользователям фай&shy;ловое пространство объединено в единое дерево каталогов,
корнем кото&shy;рого является каталог &quot;/&quot;. Таким образом, полное имя
любого файла начи&shy;нается с &quot;/&quot; и не содержит идентификатора
устройства (дискового накопителя, CD-ROM или удаленного
компьютера в сети), на котором он фактически хранится.</p> 

<p>Однако это не означает, что в системе присутствует только одна файловая
система. В большинстве случаев единое дерево, такое, каким его видит
пользователь системы, составлено из нескольких отдельных файловых сис&shy;тем,
которые могут иметь различную внутреннюю структуру, а файлы, принадлежащие этим
файловым системам, могут быть расположены на различных устройствах. Вопросы,
связанные с объединением нескольких файловых систем в единое дерево, будут
обсуждаться при рассмотрении внутреннего устройства файловой системы UNIX.</p> 

<p>Заметим, что имя файла является атрибутом файловой системы, а не набора
некоторых данных на диске, который не имеет имени как такового. Каждый файл имеет связанные с ним <i>метаданные </i>(хранящиеся в <i>индексные
дескрипторах — </i>inode), содержащие все характеристики файла и позво&shy;ляющие
операционной системе выполнять операции, заказанные при&shy;кладной задачей:
открыть файл, прочитать или записать данные, создать или удалить файл. В
частности, метаданные содержат указатели на дисковые блоки хранения данных
файла. Имя файла в файловой системе является указателем на его метаданные, в то
время как метаданные не содержат указателя на имя файла.</p> 

<h3>Типы файлов</h3> 

<p>В UNIX существуют 6 типов файлов, различающихся по функциональному назначению и
действиям операционной системы при выполнении тех или иных операций над
файлами:</p> 

<ul>
    <li>Обычный файл (regular file)</li>
    <li>Каталог (directory)</li>
    <li>Специальный файл устройства (special device file)</li>
    <li>FIFO или именованный канал (named pipe)</li>
    <li>Связь (link)</li>
    <li>Сокет</li>
</ul>
<p><i>Обычный файл </i>представляет собой наиболее общий тип файлов, содержа&shy;щий
данные в некотором формате. Для операционной системы такие фай&shy;лы представляют
собой просто последовательность байтов. Вся интерпре&shy;тация содержимого файла
производится прикладной программой, обраба&shy;тывающей файл. К этим файлам
относятся текстовые файлы, бинарные данные, исполняемые программы и т. п.</p> 

<p><i>Каталог. С </i>помощью каталогов формируется логическое дерево файловой системы. <i>Каталог
— </i>это файл, содержащий имена находящихся в нем файлов, а также указатели на
дополнительную информацию — метадан&shy;ные, позволяющие операционной системе
производить операции над эти&shy;ми файлами. Каталоги определяют положение файла в
дереве файловой системы, поскольку сам файл не содержит информации о своем
местона&shy;хождении. Любая задача, имеющая право на чтение каталога, может про&shy;честь
его содержимое, но только ядро имеет право на запись в каталог.</p> 

<p>На рис. 1.1 в качестве примера приведена структура каталога. По существу
каталог представляет собой таблицу, каждая запись которой соответствует
некоторому файлу. Первое поле каждой записи содержит указатель на ме&shy;таданные
(номер inode), а второе определяет имя файла.</p> 

<p><img width=297 height=285
src="Файлы%20и%20файловасистема.files/image002.jpg" v:shapes="_x0000_i1026"></p> 

<p><b>Рис. 1.1. </b>Структура каталога</p> 

<p><b><i>Специальный файл устройства </i></b>обеспечивает доступ к
физическому устройству. В UNIX различают <i>символьные </i>(character) и <i>блочные </i>(block) файлы устройств.
Доступ к устройствам осуществляется путем открытия, чтения и; записи в
специальный файл устройства.</p> 

<p>Символьные файлы устройств используются для небуферизированного 
обмена данными с устройством, в противоположность этому блочные файл позволяют
производить обмен данными в виде пакетов фиксированной длины — <i>блоков. </i>Доступ
к некоторым устройствам может осуществляться как через символьные, так и через
блочные специальные файлы.</p> 

<p><b><i>FIFO или именованный
канал </i></b><i>— </i>это файл, используемый для связи между процессами. FIFO впервые появились в System V UNIX, но большинство
современных систем поддерживают этот механизм. </p> 

<p><b><i>Связь. </i></b>Как уже говорилось, каталог содержит имена
файлов и указатели н их
метаданные. В то же время сами метаданные не содержат ни имен файла, ни
указателя на это имя. Такая архитектура позволяет одному фай лу иметь несколько имен в файловой системе. Имена жестко
связаны метаданными и, соответственно, с данными файла, в то время как сам файл
существует независимо от того, как его называют в файловой системе<sup>2</sup>. Такая связь имени файла с его данными
называется <i>жесткой связи </i>(hard link). Например, с
помощью команды <i>1п(1) </i>мы можем создать еще одно имя <b>(second) </b>файла, на который
указывает имя <b>first </b>(рис. 1.2).</p> 

<p>$&nbsp; pwd</p> 

<p>/home/andrei</p> 

<p><b>$ In first /home/sergey/second</b></p> 

<p>Жесткие связи абсолютно равноправны. В списках файлов каталогов, которые
можно получить с помощью команды <i>ls(l), </i>файлы <b>first и second </b>будут отличаться
только именем. Все остальные атрибуты файла будут абсолютно одинаковыми. С
точки зрения пользователя — это два разных файла. Изменения, внесенные в любой
из этих файлов, затронут и другой, поскольку оба они ссылаются на одни и те же
данные файла. Вы можете переместить один из файлов в другой каталог — все равно
эти имена буду! связаны жесткой связью с данными файла. Легко проверить, что
удаление одного из файлов <b>(first </b>или <b>second) </b>не приведет к
удалению самого файла т. е. его метаданных и данных
(если это не специальный файл устройства)</p> 

<p><sup><font size="2">2</font></sup><font size="2"> </font><i style='mso-bidi-font-style:normal'><font size="2">Данное утверждение верно лишь отчасти.
Действительно, файлу &quot;безразлично&quot;, какие имена он имеет в каталогах,
но &quot;небезразлично&quot; число этих имен. Если ни одно из имен файловой
системы не ссылается на файл — он должен быть удален (т. е. физически уда лены
его данные на диске).</font></i></p> 

<p><img width=397 height=544
src="Файлы%20и%20файловасистема.files/image004.jpg" v:shapes="_x0000_i1027"></p> 

<p>рис. 1.2 Структура файловой системы после выполнения команды <i>1п(1). </i>Жесткая
связь имен с данными файла</p> 

<p>По определению жесткие связи указывают на один и тот же индексный
Дескриптор mode. Поэтому проверить, имеют ли два имени файла жесткую <sup>св</sup>язь,
можно, вызвав команду <i>ls(l) с </i>ключом -/:</p> 

<p><b>.&nbsp;&nbsp; $&nbsp;&nbsp; Is&nbsp;&nbsp; -i /home/andrei/first&nbsp; /home/sergey/second</b></p> 

<p>12567 first</p> 

<p>12567 second</p> 

<p>Информацию о наличии у файла нескольких имен, связанных с ним жест&shy;кими
связями, можно получить, просмотрев подробный листинг файлов с помощью команды <i>Is - I:</i></p> 

<p><b>$&nbsp;&nbsp; Is — 1&nbsp; /home/sergey</b></p> 

<p>/</p> 

<p>-rw-r—г—&nbsp;&nbsp;
2&nbsp;&nbsp; andrei&nbsp;&nbsp; staff&nbsp;
7245 Jan 17 <st1:time Minute="5" Hour="8">8:05</st1:time>&nbsp;&nbsp; second</p> 

<p>Во второй колонке листинга указано число жестких связей данного файла.</p> 

<p>Сразу оговоримся, что жесткая связь является естественной формой связи
имени файла с его метаданными и не принадлежит к особому типу файла. Особым
типом файла является <i>символическая связь, </i>позволяющая косвенно
адресовать файл. В отличие от жесткой связи, символическая связь адресу&shy;ет
файл, который, в свою очередь, ссылается на другой файл. В результате,
последний файл адресуется символической связью косвенно (рис. 1.3). Данные
файла, являющегося символической связью, содержат только имя целевого файла.</p> 

<p>Проиллюстрируем эти рассуждения на примере. Команда <i>1п(1) с </i>ключом
-5 позволяет создать символическую связь:</p> 

<p>$ pwd</p> 

<p>/home/andrei</p> 

<p><b>$ In -s first /home/sergey/symfirst</b></p> 

<p><b>$ cd 
/home/sergey</b></p> 

<p>$ <b>Is </b>-1</p> 

<p>Irwxrwxrwx 1 andrei&nbsp; staff&nbsp;
<b>15 </b>Jan 17 <st1:time Minute="5" Hour="8">8:05</st1:time>&nbsp;&nbsp; <b>symfirst-&gt;../andrei/first</b></p> 

<p>Как видно из вывода команды <i>ls(l), </i>файл <b>symfirst </b>(символическая связь)
существенно отличается от файла <b>second </b>(жесткая связь).
Во-первых, фак&shy;тическое содержимое файла <b>symfirst </b>отнюдь не то же, что
и у файла <b>first </b>или <b>second, </b>об этом говорит размер
файла — 15 байт. На самом деле в этом файле хранится не что иное 
как имя файла, на которую символиче&shy;ская связь ссылается — <b>../andrei/first </b>— ровно 15 байт.
Во-вторых, файл <b>symfirst </b>не содержит никаких
ограничений на доступ (2—10 символы в пер&shy;вой колонке).</p> 

<p>Символическая связь является особым типом
файла (об этом свидетельству&shy;ет символ ‘1’ в первой позиции вывода <i>ls(l)), </i>и операционная
система рабо&shy;тает с таким файлом не так, как с обычным. Например, при выводе
на эк&shy;ран содержимого файла <b>symfirst </b>появятся данные файла
<b>/home/andrei/first.</b></p> 

<p><img width=558 height=776
src="Файлы%20и%20файловасистема.files/image006.jpg" v:shapes="_x0000_i1028"></p> 

<p>рис. 1.3. Символическая связь</p> 

<h3>Сокеты</h3> 

<p>Сокеты предназначены
для взаимодействия между процессами. Интерфейс сокетов часто используется для
доступа к сети TCP/IP. В системах, ветви</p> 

<p>BSD UNIX на базе сокетов реализована система межпроцессного 
взаимо&shy;действия, с помощью которой работают многие системные сервисы, на&shy;пример,
система печати. </p> 

<p><b>Структура файловой системы UNIX</b></p> 

<p>Использование общепринятых имен основных файлов и структуры ката&shy;логов
существенно облегчает работу в операционной системе, .ее
админи&shy;стрирование и переносимость. Эта структура используется в работе систе&shy;мы,
например при ее инициализации и конфигурировании, при
работе почтовой системы и системы печати. Нарушение этой структуры может привести
к неработоспособности системы или отдельных ее компонентов.</p> 

<p><img width=642 height=503
src="Файлы%20и%20файловасистема.files/image008.jpg" v:shapes="_x0000_i1025"></p> 

<p><b>Рис. 1.4. </b>Типичная файловая
система UNIX</p> 

</body> 

</html> 
