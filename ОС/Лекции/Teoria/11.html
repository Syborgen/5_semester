<html>
<head>
<title>База данных ОС</title>
</head>

<body>
<h1><center>База данных ОС</center></h1>
<p>
ОС в основном базируется на таблицах. Природа ОС определяется системными 
параметрами и константами.
</p>
<p> 
База данных ОС содержит всю информацию, необходимую ей для функционирования. БД
 состоит из статической части и динамической. Размер статической части не 
 изменяется, а динамическая может изменять свой размер в процессе работы системы. 
 Динамическая часть загружается за пределы системного пула. В БД содержится 
 информация о запущенных процессах, открытых файлах, подключенных пользователях и 
 т.д.
</p>
<p>
<h3>БД должна содержать следующие управляющие блоки:</h3>
<ol>
	<li>Блок управления пользователями.</li>
	<li>Блок управления файлами </li>
	<li>Блок управления памятью </li>
	<li>Блок управления каталога страниц памяти.</li>
	<li>Блок управления процессами.</li>
	<li>Блок управления устройствами.</li>
	<li>Блок управления сообщениями.</li>
</ol>
<h3>БД должна содержать список очередей процессов:</h3>
	Каждая очередь базы данных операционной системы представляет собой двусвязный 
	динамический список с указателями на начало и конец очереди.<br>
	Каждый процесс имеет свою отдельную очередь сообщений .<br> 
Каждый блок управления процессом содержит указатели на начало и конец своей 
очереди сообщений . <br>
Список всех запущенных в системе процессов , содержит все процессы , которые также 
содержатся в очереди готовых процессов , очереди блокированных внешними 
устройствами процессов или в списке процессов , ожидающих сообщения . <br>
<p>
	<i>Очередь всех процессов (TQ_IN)</i>
	<i>Очередь процессов, ожидающих устройство (TQ_DEV_ID) </i>(При загрузки ОС 
	определяет устройства. Каждому устройству присваивается уникальный ID. В 
	зависимости от скорости обслуживания формируется новая очередь процессов, 
	ожидающих доступ к данному устройству. ID устройств сохраняется при выходе из 
	ОС. Если при повторном запуске будет обнаружено новое устройство, будет сделана
	 попытка присвоить ему свой ID и в зависимости от загрузки создать ему очередь).
</p>
<p>	 
	<i>Очередь к файлу ID (TQ_FDEV_ID)<br>
	Очередь готовых процессов (TQ_OUT)<br>
	Очередь к терминалу (TQ_TER).</i> Представляет собой очередь процессов, 
	которые активно взаимодействуют с пользователями.
</p>

	<h3>Операции над очередями:</h3>
	Взять голову из очереди (ETQ_GET)<br>
	Поместить в хвост очереди (ETQ_PUT)<br>
	Пересмотреть очередь (ETQ_REF) (Данная операция выполняется автоматически - 
	производится сортировка очереди в соответствие с приоритетами после каждого
	выхода из очереди).<br>
Количество элементов в очереди (ETQ_LNG)<br>
<h3>Переменные и константы</h3>
Количество страниц памяти<br>
Маркер свободен/занят для устройства с номером ID.<br>
Маркер свободен/занят для файла с номером ID.<br>
Маркер свободен/занят для терминала ID.<br>
Количество свободных страниц памяти<br>
Номер первой свободной страницы<br>
Максимальное количество запускаемых процессов<br>
Максимальное число открытых файлов.<br>

<h3>Общая схема организации БД</h3>
<p>При входе в систему блок управления пользователями регистрирует пользователя, при выходе пользователя из системы запись о нем удаляется из системы.</p>
<p>При запуске процесса блок управления процессами регистрирует процесс, при завершении процесса, запись о нем удаляется.</p>
<p>При обращении к ОП блок управления памятью регистрирует управление обращение, определяет по ряду признаков возможность доступа и права пользователя, при завершении работы процесса с этим сегментом блок выставляет флаг доступа в 1, разрешая тем самым другому процессу занять этот сегмент.</p>
<p>Блок управления устройствами регистрирует все устройства, их текущее состояние, изменяя его в ходе работы.</p>
<p>Блок управления файлами заносит запись об открытом файле в таблицу, устанавливает признаки, при закрытии файла запись удаляется из таблицы.</p>


<IMG SRC="11/bdoos1.bmp"><BR>

<h3>Блок управления пользователями (User Control Block) UCB:</h3>
<ul>
   <li>UCB_ID - ID пользователя;</li>
<li>UCB_Name - имя пользователя</li>
<li>UCB_GROUP - группа пользователя (текущая)</li>
<li>UCB_RIGHT - права пользователя</li>
</ul>

<h3>Блок управления файлами File Control Block (FCB)</h3>
При открытии файла, в БД создается запись для этого файла, при его закрытии, она удаляется. Если с файлом работает несколько процессов одновременно, то все связи с процессами этого файла указываются Процесс, открывший  файл первым, может запретить доступ к нему другими процессами. Блок управления файлами - динамическая часть базы данных, размер этого блока изменяется при изменении системной переменной, определяющей количество открытых файлов.
<p>
Структура перекрестной таблицы (File Process Table) состоит из двух записей: номер файла FPT_FID=FCB_ID и номера процесса FPT_PID=TCB_ID.</p>
<ul>
<li>FCB_ID - ID файла;<br></li>
<li>FCB_NAME - имя файла<br></li>
<li>FCB_FPT - адрес перекрестной таблицы<br></li>
<li>FCB_FPCOUNT - количество связей файла<br></li>
<li>FCB_DEVID -  ID устройства<br></li>
<li>FCB_SIZE - размер файла<br></li>
<li>FCB_UID - идентификатор владельца<br></li>
<li>FCB_GUID - идентификатор группы<br></li>
<li>FCB_DATE - дата создания<br></li>
<li>FCB_TIME - время создания<br></li>
<li>FCB_HDATE - дата изменения<br></li>
<li>FCB_HTIME - время изменения<br></li>
<li>FCB_START - начальный кластер<br></li>
<li>FCB_ATTR - атрибуты файла<br></li>
<li>FCB_NEXT - указатель на следующий FCB<br>
</ul>
<h3>Блок управления памятью. Memory Control Block </h3>
Информация об оперативной памяти располагается в статической части БД и не является набором структур, в блоке управления памятью хранится информация об общем размере, начальные адреса физических сегментов.<br>
RCB_HANDLE - дескриптор блока<br>
RCB_SIZE - размер блока<br>
RCB_CADR - текущий адрес блока<br>
RCB_RIGHT - права доступа<br>
<p>
<h3>Блок каталога страниц памяти. Page Mapping Table Control Block (PCB)</h3>
PCB_TID - ID таблицы страниц<br>
PCB_DESCRIPT - описание страницы
</p>
<h3>Блок управления процессами Task Control Block (TCB)</h3>
Максимально количество одновременно запущенных процессов определяется системной переменной SYSP_MAXP, которая может быть изменена привилегированными пользователем. Для того, чтобы избежать необходимости перезагрузки системы после изменения значения переменной, дескрипторы процессов располагаются в динамической части БД. В статической части располагается информация о количестве запущенных процессов и адреса таблицы дескрипторов процессов.<br>
<ul>
<li>TCB_ID - ID процесса ID=00xxxxxx - системный процесс.</li>
<li>		ID=01xxxxxx - резидентный процесс.</li>
<li>TCB_NAME - имя процесса.</li>
<li>TCB_QID - идентификатор очереди, в которой стоит процесс</li>
<li>TCB_PPID - идентификатор процесса-родителя</li>
<li>TCB_UID - идентификатор пользователя</li>
<li>TCB_INP - точка входа процесса (начальный адрес сегмента)</li>
<li>TCB_RPIO - приоритет процесса, первый бит - признак абсолютного приоритета</li>
<li>TCB_CONT - контекст процесса (состояние регистров, указатель стека) и объем занимаемой памяти</li>
<li>TCB_RUN - команда запуска - представляет собой набор маркеров, характеризующих состояние процесса:</li>
<ul>
		<li>"выполнить" -  если установлен в единицу, то процесс получит следующий квант</li>
		<li>"активный" - определяет доступ к видеопамяти</li>
	    <li> "состояние" - определяет текущее состояние процесса для планировщика</li>
</ul>	

<liTCB_NEXT - следующий TCB в списке процессов</li>
<li>TCB_MES - адрес таблицы сообщений процесса</li>
<li>TCB_COUNT - количество сообщений процесса. Чем больше количество сообщений, тем выше приоритет процесса.</li>
</ul>
<h3>Блок управления устройствами. Device Control Block (DCB).</h3>
В статической части БД хранится только флаг наличия устройства в  системе DCB_ST, название устройства DCB_NAME и адрес драйвера в памяти DCB_DRV.<br>
<p>
ОС автоматически, через некоторый промежуток времени проверяет статус устройства (DCB_ST). При отсутствия устройства, которое было подключено, драйвер выгружается из памяти. При обнаружении нового устройства, ОС получает данные об устройстве и загружает соответствующий драйвер. При отсутствии необходимого драйвера (например, устройство не поддерживается системой по умолчанию), привилегированному пользователю предлагается указать местоположение драйвера.
</p>
<p>
Каждое устройство имеет свой запрос на прерывание и порт ввода вывода. При загрузке драйвера ему сообщается эта информация, и дальнейшая работа с устройством ведется только посредством драйвера. Для незанятых прерываний формируются "заглушки" - пустые устройства, статус которых "отсутствует".
</p>
Блок управления устройством содержит следующую информацию:
<ul>
<li>DCB_ID - ID устройства</li>
<li>DCB_NAME - имя устройства</li>
<li>DCB_ST - статус устройства</li>
<li>DCB_INT - таблица точек входа</li>
<li>DCB_INIT - инициализация</li>
<li>DCB_WRITE - флаг записи</li>
<li>DCB_READ - флаг чтения</li>
<li>DCB_PROP - параметры устройства</li>
<li>DCB_DRV - адрес драйвера устройства</li>
<li>DCB_NEXT - адрес следующего DCB</li>
</ul>
<h3>Блок управления сообщениями. Message Control Block (MBC).</h3>
Блок управления сообщениями - динамическая часть БД. Производит обработку входящих сообщений ОС. Для каждого процесса создается отдельная таблица входящих сообщений, содержащая ссылку на общую таблицу сообщений (MGT).
<p>
Каждый раз, когда возникает системное сообщение, в дескрипторы процессов, подключенных к этому сообщению, добавляется номер сообщения и сопутствующая  информация. При получении процессом кванта времени, сначала вызываются обработчики пришедших сообщений. Процесс продолжает выполнение только после этого. Кроме того, процесс может послать сообщение другому процессу.
</p>

<IMG SRC="11/tabl1.bmp"><BR>
</body>
</html>
